import{A as $,h as j,k as z,T as G,u as e,l as M,p as q,U as H,R as _,g as W,c as J}from"./main-nVfmSndt.js";import{G as Q}from"./GhostBlueprints-_y5Up0kp.js";import{u as R,a as y,U as X}from"./UnlockSelect-RSBuAXyM.js";import{u as Y}from"./usePersistentState-MhNDfNJZ.js";const B=[...$].filter(t=>t.IsPurchasable||t.IsPurchasableAsUpgrade);console.log({options:B.length,unique:new Set(B.map(t=>t.ID)).size});function Z(t,a,i,s){const l=a.toLowerCase();return B.filter(function(o){return i&&o.AllowRefreshes&&!o.SellOnlyAsDuplicate&&t.some(m=>m.AllowRefreshes)?!1:(s||!t.some(m=>m.ID===o.ID))&&o.Name.toLowerCase().includes(l)&&(!i||o.StapleWhenMissing||o.SellOnlyAsUnique||!o.SellOnlyAsDuplicate&&o.AllowRefreshes)}).sort((r,o)=>r.Name<o.Name?-1:1)}function ee({onSelectionChange:t,label:a,placeholder:i,include:s=!0,appliances:l=[],shopModifiersOnly:r=!0,allowDupes:o=!1}){const[m,w]=j(""),f=z(()=>Z(l,m,r,o),[l,m]),{getSelectedItemProps:O,getDropdownProps:h,removeSelectedItem:d}=R({selectedItems:l,onStateChange({selectedItems:p,type:u}){switch(u){case R.stateChangeTypes.SelectedItemKeyDownBackspace:case R.stateChangeTypes.SelectedItemKeyDownDelete:case R.stateChangeTypes.DropdownKeyDownBackspace:case R.stateChangeTypes.FunctionRemoveSelectedItem:t(p??[]);break}}}),{isOpen:c,getToggleButtonProps:D,getLabelProps:S,getMenuProps:T,getInputProps:I,highlightedIndex:v,getItemProps:k,selectedItem:C}=y({items:f,itemToString(p){return p?p.Name:""},defaultHighlightedIndex:-1,selectedItem:null,inputValue:m,stateReducer(p,u){const{changes:n,type:g}=u;switch(g){case y.stateChangeTypes.InputChange:return u.inputValue?{...n,highlightedIndex:0}:{...n,highlightedIndex:-1};case y.stateChangeTypes.InputKeyDownEnter:return{...n,isOpen:!1,highlightedIndex:-1};case y.stateChangeTypes.ItemClick:return{...n,isOpen:!0,highlightedIndex:-1};default:return n}},onStateChange({inputValue:p,type:u,selectedItem:n}){switch(u){case y.stateChangeTypes.InputKeyDownEnter:case y.stateChangeTypes.ItemClick:case y.stateChangeTypes.InputBlur:n&&(t([...l,n]),w(""));break;case y.stateChangeTypes.InputChange:w(p??"");break}}}),A=G(()=>{t([])},[]);return e("div",{className:"combo-container",children:[e("div",{className:"",children:[e("label",{className:"",...S(),children:a??"Select desired appliances"}),e("div",{children:e("button",{onClick:A,children:"Clear Appliances"})}),e("div",{className:"",children:[l.map(function(u,n){return e("span",{className:"selected-items"+(s?" include":" exclude"),...O({selectedItem:u,index:n}),children:[u.Name,e("span",{class:"x",onClick:g=>{g.stopPropagation(),d(u)},children:"âœ•"})]},`selected-item-${n}`)}),e("div",{className:"",children:e("input",{placeholder:i??"Appliance Selection(s)",className:"",...I(h({preventKeyAction:c}))})})]})]}),e("ul",{className:`dropdown ${c&&f.length?"":"hidden"}`,...T(),children:[!1,c&&f.map((p,u)=>e("li",{className:ne(v===u&&"bg-blue-300",C===p&&"font-bold","py-2 px-3 shadow-sm flex flex-col"),...k({item:p,index:u}),children:e("span",{children:p.Name})},`${p.ID}${u}`))]})]})}const ne=(...t)=>t.filter(a=>a).join(" ");function te(t){let a="";if(!t.length)a="Spawn: any settings";else{for(let s=0;s<t.length;s++){const l=t[s];let r=s?`Reroll ${s}`:"Spawn";r+=": ",r+="Blueprints "+(l.spawnInside?"Spawn Inside":"Spawn Outside, "+(l.playerInside?"Someone Inside":"All Players Stand Outside")),s&&(r+=`, reroll ${t[s].blueprintCount} blueprints`),a+=r+`
`}a+=`Reroll ${t.length}: any settings`}const i=a.split(`
`);return e("div",{class:"reroll-instructions",onClick:s=>{if(s.detail<2)return;const l=document.createRange();l.selectNodeContents(s.currentTarget);const r=document.getSelection();r==null||r.removeAllRanges(),r==null||r.addRange(l)},children:i.map(s=>e("div",{children:s}))})}const F=$.filter(t=>t.Name==="Booking Desk"||t.Name==="Blueprint Cabinet").sort((t,a)=>t.Name<a.Name?1:-1);function se(t,a,i){const s=t.at(-1);if(a==="insideOnly"||i&&a==="noSwitching"||a==="noSwitching"&&(s!=null&&s.spawnInside))switch(((s==null?void 0:s.blueprintCount)??0)%3){case 0:return"I";case 1:return"OI";default:return"OO"}return s!=null&&s.spawnInside?"I":s!=null&&s.playerInside?"OI":"OO"}const le=[0,3,5,6,9,12],ae=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],re=({seed:t,day:a,startingConfig:i=[],baseUpgradeChance:s=0,blueprintCount:l=5,searchDepth:r=2,ghostBlueprints:o=2,blueprintCabinets:m=1,solo:w,cards:f=[],appliances:O=[],simpleBPSettings:h=!1})=>{var A,p,u;t=t.toLocaleLowerCase().trim();const d={blueprintCount:l+o,spawnInside:!0},c=new J(t,s),D=l===7;let S=[];const T=D?ae:le;{let n=f.filter(g=>_.some(N=>N.ID===g.ID)).length;for(const g of T){if(g>a){console.log(`added up to card ${n}: ${f.slice(0,n).map(N=>N.Name).join(", ")}`);break}g===a?(S.push(f[n]),c.handleNewCardSpawnEffects(f[n])):c.addCard(f[n]),n++}}c.OwnedAppliances=[...c.OwnedAppliances,...O];const I=[],v=[];for(let n=-m-1;n<=m;n++){const g={spawnInside:!0,blueprintCount:l+n};n===0&&v.push(g),I.push(g),h!=="insideOnly"&&(n===0&&(v.push({spawnInside:!1,playerInside:!0,blueprintCount:l+n}),v.push({spawnInside:!1,playerInside:!1,blueprintCount:l+n})),w||I.push({spawnInside:!1,playerInside:!0,blueprintCount:l+n}),I.push({spawnInside:!1,playerInside:!1,blueprintCount:l+n}))}let k=[],C=[i];for(let n=0;n<=r;n++){if(n)for(const b of S)c.handleNewCardRerollEffects(b);let g=[],N=[];for(let b=0;b<C.length;b++){const U={...d};U.blueprintCount=C[b].length?(((A=C[b].at(-1))==null?void 0:A.blueprintCount)??l)+o:l;const L=c.getAppliances([...C[b],U],a).map(x=>x.Name),E=h==="noSwitching"?w||(u=(p=C[b])==null?void 0:p[0])!=null&&u.spawnInside?I.length/(w?2:3):I.length*2/3:I.length;N.push(e("td",{class:"reroll-cell "+se(C[b],h,w),colspan:E**(r-n),children:[e(Q,{bps:L,ghostCount:n===0?0:o}),te(C[b])]}));const V=i.length+n===0?v:I;for(const x of V){const P=[...C[b]];h==="noSwitching"&&P.length&&P[0].spawnInside!==x.spawnInside||(P.push(x),g.push(P))}}k.push(e("tr",{children:[e("td",{children:n?`Reroll ${n}`:"Spawns"}),N]})),C=g}return e("table",{children:[" ",k," "]})},ie=({onConfigChange:t,config:a})=>{const{seed:i,day:s,blueprintCount:l,solo:r,appliances:o=F,cards:m,searchDepth:w,simpleBPSettings:f=!1}=a,O=d=>{let c={...a};d.target.checked?(c.blueprintCount=7,c.baseUpgradeChance=.25):(c.blueprintCount=5,c.baseUpgradeChance=0),t(c)},h=(d,c)=>{t(D=>{let S={...D};return S[d]=c,S})};return e("div",{children:[e("div",{children:[e("div",{children:"Run Config:"}),e("label",{for:"solo",children:"Solo:"}),e("input",{type:"checkbox",id:"solo",checked:r,onChange:()=>{h("solo",!r)}}),e("span",{style:"margin:0 20px",children:[e("label",{for:"simpleRerollSettings",children:"Spawn setting configs: "}),e("select",{value:f===!0?"insideOnly":f===!1?"full":f,onChange:d=>{var c;h("simpleBPSettings",((c=d.target)==null?void 0:c.value)??"full")},children:[e("option",{value:"full",children:"All spawn settings"}),e("option",{value:"insideOnly",children:"Spawn Inside only"}),e("option",{value:"noSwitching",children:"Don't switch bp settings after spawn"})]})]}),e("div",{children:[e("label",{for:"searchDepth",children:"Number of Rerolls"})," ",e("input",{id:"searchDepth",type:"number",value:w,onChange:d=>{h("searchDepth",Number(d.target.value))}})]}),e("label",{for:"seed",value:i,children:["Seed:"," "]}),e("input",{type:"text",id:"seed",value:i,onChange:d=>{h("seed",d.target.value)}}),e("label",{for:"setting",children:" Turbo?"}),e("input",{id:"setting",type:"checkbox",checked:l===7,onChange:O})]}),e("div",{children:[e("label",{for:"day",value:s,children:["Prep of Day:"," "]}),e("input",{type:"number",id:"day",value:s+1,onChange:d=>{h("day",Number(d.target.value)-1)}}),e(X,{id:"cardSchedule",label:"Enter all cards in order, including your starting dish:",onSelectionChange:d=>{h("cards",d.cards)},showSelectionMode:!1,cards:m,include:!0,modes:["themes","dishes","customerCards"]}),e(ee,{label:"Select owned appliances:",placeholder:"",onSelectionChange:d=>{h("appliances",d)},appliances:o})]})]})},K={seed:"az",day:2,cards:[],initialRerollConfig:[],blueprintCount:5,baseUpgradeChance:0,solo:!1,appliances:F,searchDepth:2,simpleBPSettings:!1},oe=()=>{const[t,a]=Y(K,"BRANCH_CONFIG",l=>{if(typeof l.simpleBPSettings=="boolean"){debugger;return{...l,simpleBPSettings:l.simpleBPSettings?"insideOnly":"full"}}return l}),[i,s]=M();return q(()=>{i.has("cards")&&(a(l=>({...l,seed:i.get("seed")??l.seed,cards:i.get("cards").split(",").map(r=>{if(r==="Turbo")debugger;return H.filter(o=>o.Name===r)[0]??_.filter(o=>o.Name===r)[0]}),blueprintCount:i.get("turbo")?7:5,baseUpgradeChance:i.get("turbo")?.25:0,solo:!!Number(i.get("solo"))})),s(new URLSearchParams,{replace:!0}))},[i]),e(W,{children:[e("div",{children:["Hover over a cell for instructions on how to get those blueprints. Getting the blueprints in grey requires taking extra blueprints out of cabinets."," ",e("span",{style:"font-size:small",children:"(Rerolls are inaccurate if you bought a blueprint desk)"})]}),e(ie,{onConfigChange:a,config:t}),e(re,{...t,blueprintCabinets:1}),!1]})},he=Object.freeze(Object.defineProperty({__proto__:null,default:oe,defaultBranchingRerollConfig:K},Symbol.toStringTag,{value:"Module"}));export{ee as A,he as b,K as d};
