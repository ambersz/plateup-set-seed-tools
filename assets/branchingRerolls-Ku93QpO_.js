import{A as $,S as z}from"./shop-nZDvkY5y.js";import{G}from"./GhostBlueprints-IsYLidWZ.js";import{u as M}from"./usePersistentState-QZnuxCCl.js";import{h as j,F as q,T as H,u as e,a as W,p as J,g as Q}from"./main-LoDFSLAM.js";import{U as X,R as _,S as Y}from"./unlocks-ENjzZK3S.js";import{u as D,a as S,U as Z}from"./UnlockSelect-8Y3Qa_AR.js";const B=[...$].filter(s=>s.IsPurchasable||s.IsPurchasableAsUpgrade);console.log({options:B.length,unique:new Set(B.map(s=>s.ID)).size});function ee(s,r,i,t){const l=r.toLowerCase();return B.filter(function(u){return i&&u.AllowRefreshes&&!u.SellOnlyAsDuplicate&&s.some(o=>o.AllowRefreshes)?!1:(t||!s.some(o=>o.ID===u.ID))&&u.Name.toLowerCase().includes(l)&&(!i||u.StapleWhenMissing||u.SellOnlyAsUnique||!u.SellOnlyAsDuplicate&&u.AllowRefreshes)}).sort((a,u)=>a.Name<u.Name?-1:1)}function ne({onSelectionChange:s,label:r,placeholder:i,include:t=!0,appliances:l=[],shopModifiersOnly:a=!0,allowDupes:u=!1}){const[o,f]=j(""),g=q(()=>ee(l,o,a,u),[l,o]),{getSelectedItemProps:c,getDropdownProps:w,removeSelectedItem:m}=D({selectedItems:l,onStateChange({selectedItems:p,type:d}){switch(d){case D.stateChangeTypes.SelectedItemKeyDownBackspace:case D.stateChangeTypes.SelectedItemKeyDownDelete:case D.stateChangeTypes.DropdownKeyDownBackspace:case D.stateChangeTypes.FunctionRemoveSelectedItem:s(p??[]);break}}}),{isOpen:y,getToggleButtonProps:v,getLabelProps:O,getMenuProps:T,getInputProps:I,highlightedIndex:N,getItemProps:R,selectedItem:C}=S({items:g,itemToString(p){return p?p.Name:""},defaultHighlightedIndex:-1,selectedItem:null,inputValue:o,stateReducer(p,d){const{changes:n,type:h}=d;switch(h){case S.stateChangeTypes.InputChange:return d.inputValue?{...n,highlightedIndex:0}:{...n,highlightedIndex:-1};case S.stateChangeTypes.InputKeyDownEnter:return{...n,isOpen:!1,highlightedIndex:-1};case S.stateChangeTypes.ItemClick:return{...n,isOpen:!0,highlightedIndex:-1};default:return n}},onStateChange({inputValue:p,type:d,selectedItem:n}){switch(d){case S.stateChangeTypes.InputKeyDownEnter:case S.stateChangeTypes.ItemClick:case S.stateChangeTypes.InputBlur:n&&(s([...l,n]),f(""));break;case S.stateChangeTypes.InputChange:f(p??"");break}}}),A=H(()=>{s([])},[]);return e("div",{className:"combo-container",children:[e("div",{className:"",children:[e("label",{className:"",...O(),children:r??"Select desired appliances"}),e("div",{children:e("button",{onClick:A,children:"Clear Appliances"})}),e("div",{className:"",children:[l.map(function(d,n){return e("span",{className:"selected-items"+(t?" include":" exclude"),...c({selectedItem:d,index:n}),children:[d.Name,e("span",{class:"x",onClick:h=>{h.stopPropagation(),m(d)},children:"âœ•"})]},`selected-item-${n}`)}),e("div",{className:"",children:e("input",{placeholder:i??"Appliance Selection(s)",className:"",...I(w({preventKeyAction:y}))})})]})]}),e("ul",{className:`dropdown ${y&&g.length?"":"hidden"}`,...T(),children:[!1,y&&g.map((p,d)=>e("li",{className:te(N===d&&"bg-blue-300",C===p&&"font-bold","py-2 px-3 shadow-sm flex flex-col"),...R({item:p,index:d}),children:e("span",{children:p.Name})},`${p.ID}${d}`))]})]})}const te=(...s)=>s.filter(r=>r).join(" "),se=({onConfigChange:s,config:r})=>{const{seed:i,day:t,solo:l,appliances:a=F,cards:u,searchDepth:o,simpleBPSettings:f=!1}=r,g=(c,w)=>{s(m=>{let y={...m};return y[c]=w,y})};return e("div",{children:[e("div",{children:[e("div",{children:"Run Config:"}),e("label",{for:"solo",children:"Solo:"}),e("input",{type:"checkbox",id:"solo",checked:l,onChange:()=>{g("solo",!l)}}),e("span",{style:"margin:0 20px",children:[e("label",{for:"simpleRerollSettings",children:"Spawn setting configs: "}),e("select",{value:f===!0?"insideOnly":f===!1?"full":f,onChange:c=>{var w;g("simpleBPSettings",((w=c.target)==null?void 0:w.value)??"full")},children:[e("option",{value:"full",children:"All spawn settings"}),e("option",{value:"insideOnly",children:"Spawn Inside only"}),e("option",{value:"noSwitching",children:"Don't switch bp settings after spawn"})]})]}),e("div",{children:[e("label",{for:"searchDepth",children:"Number of Rerolls"})," ",e("input",{id:"searchDepth",type:"number",value:o,onChange:c=>{g("searchDepth",Number(c.target.value))}})]}),e("label",{for:"seed",value:i,children:["Seed:"," "]}),e("input",{type:"text",id:"seed",value:i,onChange:c=>{g("seed",c.target.value)}})]}),e("div",{children:[e("label",{for:"day",value:t,children:["Prep of Day:"," "]}),e("input",{type:"number",id:"day",value:t+1,onChange:c=>{g("day",Number(c.target.value)-1)}}),e(Z,{id:"cardSchedule",label:"Enter all cards in order, beginning with your map setting and starting dish:",onSelectionChange:c=>{g("cards",c.cards)},showSelectionMode:!1,cards:u,include:!0,modes:["themes","settings","dishes","customerCards"]}),e(ne,{label:"Select owned appliances:",placeholder:"",onSelectionChange:c=>{g("appliances",c)},appliances:a})]})]})},F=$.filter(s=>s.Name==="Booking Desk"||s.Name==="Blueprint Cabinet").sort((s,r)=>s.Name<r.Name?1:-1);function le(s){let r="";if(!s.length)r="Spawn: any settings";else{for(let t=0;t<s.length;t++){const l=s[t];let a=t?`Reroll ${t}`:"Spawn";a+=": ",a+="Blueprints "+(l.spawnInside?"Spawn Inside":"Spawn Outside, "+(l.playerInside?"Someone Inside":"All Players Stand Outside")),t&&(a+=`, reroll ${s[t].blueprintCount} blueprints`),r+=a+`
`}r+=`Reroll ${s.length}: any settings`}const i=r.split(`
`);return e("div",{class:"reroll-instructions",onClick:t=>{if(t.detail<2)return;const l=document.createRange();l.selectNodeContents(t.currentTarget);const a=document.getSelection();a==null||a.removeAllRanges(),a==null||a.addRange(l)},children:i.map(t=>e("div",{children:t}))})}function ae(s,r,i){const t=s.at(-1);if(r==="insideOnly"||i&&r==="noSwitching"||r==="noSwitching"&&(t!=null&&t.spawnInside))switch(((t==null?void 0:t.blueprintCount)??0)%3){case 0:return"I";case 1:return"OI";default:return"OO"}return t!=null&&t.spawnInside?"I":t!=null&&t.playerInside?"OI":"OO"}const re=[0,3,5,6,9,12],ie=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],oe=({seed:s,day:r,startingConfig:i=[],baseUpgradeChance:t=0,searchDepth:l=2,ghostBlueprints:a=2,blueprintCabinets:u=1,solo:o,cards:f=[],appliances:g=[],simpleBPSettings:c=!1})=>{var A,p,d;const w=f.some(n=>n.Name==="Turbo"),m=w?7:5;s=s.toLocaleLowerCase().trim();const y={blueprintCount:m+a,spawnInside:!0},v=new z(s,t);let O=[];const T=w?ie:re;{let n=f.filter(h=>_.some(k=>k.ID===h.ID)).length;for(const h of T){if(h>r)break;h===r?(O.push(f[n]),v.handleNewCardSpawnEffects(f[n])):v.addCard(f[n]),n++}}v.OwnedAppliances=[...v.OwnedAppliances,...g];const I=[],N=[];for(let n=-u-1;n<=u;n++){const h={spawnInside:!0,blueprintCount:m+n};n===0&&N.push(h),I.push(h),c!=="insideOnly"&&(n===0&&(N.push({spawnInside:!1,playerInside:!0,blueprintCount:m+n}),N.push({spawnInside:!1,playerInside:!1,blueprintCount:m+n})),o||I.push({spawnInside:!1,playerInside:!0,blueprintCount:m+n}),I.push({spawnInside:!1,playerInside:!1,blueprintCount:m+n}))}let R=[],C=[i];for(let n=0;n<=l;n++){if(n)for(const b of O)v.handleNewCardRerollEffects(b);let h=[],k=[];for(let b=0;b<C.length;b++){const U={...y};U.blueprintCount=C[b].length?(((A=C[b].at(-1))==null?void 0:A.blueprintCount)??m)+a:m;const L=v.getAppliances([...C[b],U],r).map(x=>x.Name),E=c==="noSwitching"?o||(d=(p=C[b])==null?void 0:p[0])!=null&&d.spawnInside?I.length/(o?2:3):I.length*2/3:I.length;k.push(e("td",{class:"reroll-cell "+ae(C[b],c,o),colspan:E**(l-n),children:[e(G,{bps:L,ghostCount:n===0?0:a}),le(C[b])]}));const V=i.length+n===0?N:I;for(const x of V){const P=[...C[b]];c==="noSwitching"&&P.length&&P[0].spawnInside!==x.spawnInside||(P.push(x),h.push(P))}}R.push(e("tr",{children:[e("td",{children:n?`Reroll ${n}`:"Spawns"}),k]})),C=h}return e("table",{children:[" ",R," "]})},K={seed:"az",day:1,cards:[],initialRerollConfig:[],solo:!1,appliances:F,searchDepth:2,simpleBPSettings:!1},ce=()=>{const[s,r]=M(K,"BRANCH_CONFIG",l=>{if(typeof l.simpleBPSettings=="boolean"){debugger;return{...l,simpleBPSettings:l.simpleBPSettings?"insideOnly":"full"}}return l}),[i,t]=W();return J(()=>{i.has("cards")&&(r(l=>({...l,seed:i.get("seed")??l.seed,cards:i.get("cards").split(",").map(a=>{if(a==="Turbo")debugger;return X.filter(o=>o.Name===a)[0]??_.filter(o=>o.Name===a)[0]??Y.filter(o=>o.Name===a)[0]}),blueprintCount:i.get("turbo")?7:5,baseUpgradeChance:i.get("turbo")?.25:0,solo:!!Number(i.get("solo"))})),t(new URLSearchParams,{replace:!0}))},[i]),e(Q,{children:[e("div",{children:["Hover over a cell for instructions on how to get those blueprints. Getting the blueprints in grey requires taking extra blueprints out of cabinets."," ",e("span",{style:"font-size:small",children:"(Rerolls are inaccurate if you bought a blueprint desk)"})]}),e(se,{onConfigChange:r,config:s}),e(oe,{...s,blueprintCabinets:1}),!1]})},me=Object.freeze(Object.defineProperty({__proto__:null,default:ce,defaultBranchingRerollConfig:K},Symbol.toStringTag,{value:"Module"}));export{ne as A,se as S,me as b,K as d};
