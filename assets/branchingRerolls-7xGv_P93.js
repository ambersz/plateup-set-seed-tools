import{A as U,h as E,b as V,u as e,c as G,p as H,U as M,g as _,d as j}from"./main-KvskKhrK.js";import{G as q}from"./GhostBlueprints-AW6fuQWR.js";import{u as R,a as y,U as z}from"./UnlockSelect-A_eX4YZK.js";import{u as W}from"./usePersistentState-9Vp-5KRa.js";const J=[...U];function Q(l,a,o){const n=a.toLowerCase();return J.filter(function(s){return o&&s.AllowRefreshes&&!s.SellOnlyAsDuplicate&&l.some(p=>p.AllowRefreshes)?!1:!l.some(p=>p.ID===s.ID)&&s.Name.toLowerCase().includes(n)&&(!o||s.StapleWhenMissing||s.SellOnlyAsUnique||!s.SellOnlyAsDuplicate&&s.AllowRefreshes)}).sort((t,s)=>t.Name<s.Name?-1:1)}function X({onSelectionChange:l,label:a,placeholder:o,include:n=!0,appliances:t=[],shopModifiersOnly:s=!0}){const[p,I]=E(""),m=V(()=>Q(t,p,s),[t,p]),{getSelectedItemProps:C,getDropdownProps:O,removeSelectedItem:h}=R({selectedItems:t,onStateChange({selectedItems:i,type:u}){switch(u){case R.stateChangeTypes.SelectedItemKeyDownBackspace:case R.stateChangeTypes.SelectedItemKeyDownDelete:case R.stateChangeTypes.DropdownKeyDownBackspace:case R.stateChangeTypes.FunctionRemoveSelectedItem:l(i??[]);break}}}),{isOpen:c,getToggleButtonProps:d,getLabelProps:S,getMenuProps:D,getInputProps:T,highlightedIndex:w,getItemProps:v,selectedItem:k}=y({items:m,itemToString(i){return i?i.Name:""},defaultHighlightedIndex:-1,selectedItem:null,inputValue:p,stateReducer(i,u){const{changes:g,type:N}=u;switch(N){case y.stateChangeTypes.InputChange:return u.inputValue?{...g,highlightedIndex:0}:{...g,highlightedIndex:-1};case y.stateChangeTypes.InputKeyDownEnter:return{...g,isOpen:!1,highlightedIndex:-1};case y.stateChangeTypes.ItemClick:return{...g,isOpen:!0,highlightedIndex:-1};default:return g}},onStateChange({inputValue:i,type:u,selectedItem:g}){switch(u){case y.stateChangeTypes.InputKeyDownEnter:case y.stateChangeTypes.ItemClick:case y.stateChangeTypes.InputBlur:g&&(l([...t,g]),I(""));break;case y.stateChangeTypes.InputChange:I(i??"");break}}});return e("div",{className:"combo-container",children:[e("div",{className:"",children:[e("label",{className:"",...S(),children:a??"Select desired cards"}),e("div",{className:"",children:[t.map(function(u,g){return e("span",{className:"selected-items"+(n?" include":" exclude"),...C({selectedItem:u,index:g}),children:[u.Name,e("span",{class:"x",onClick:N=>{N.stopPropagation(),h(u)},children:"âœ•"})]},`selected-item-${g}`)}),e("div",{className:"",children:e("input",{placeholder:o??"Card Selection(s)",className:"",...T(O({preventKeyAction:c}))})})]})]}),e("ul",{className:`dropdown ${c&&m.length?"":"hidden"}`,...D(),children:[!1,c&&m.map((i,u)=>e("li",{className:Y(w===u&&"bg-blue-300",k===i&&"font-bold","py-2 px-3 shadow-sm flex flex-col"),...v({item:i,index:u}),children:e("span",{children:i.Name})},`${i.ID}${u}`))]})]})}const Y=(...l)=>l.filter(a=>a).join(" ");function Z(l){let a="";if(!l.length)a="Spawn: any settings";else{for(let n=0;n<l.length;n++){const t=l[n];let s=n?`Reroll ${n}`:"Spawn";s+=": ",s+="Blueprints "+(t.spawnInside?"Spawn Inside":"Spawn Outside, "+(t.playerInside?"Someone Inside":"All Players Stand Outside")),n&&(s+=`, reroll ${l[n].blueprintCount} blueprints`),a+=s+`
`}a+=`Reroll ${l.length}: any settings`}const o=a.split(`
`);return e("div",{class:"reroll-instructions",onClick:n=>{if(n.detail<2)return;const t=document.createRange();t.selectNodeContents(n.currentTarget);const s=document.getSelection();s==null||s.removeAllRanges(),s==null||s.addRange(t)},children:o.map(n=>e("div",{children:n}))})}const $=U.filter(l=>l.Name==="Booking Desk"||l.Name==="Blueprint Cabinet").sort((l,a)=>l.Name<a.Name?1:-1);function ee(l,a,o){const n=l.at(-1);if(a==="insideOnly"||o&&a==="noSwitching"||a==="noSwitching"&&(n!=null&&n.spawnInside))switch(((n==null?void 0:n.blueprintCount)??0)%3){case 0:return"I";case 1:return"OI";default:return"OO"}return n!=null&&n.spawnInside?"I":n!=null&&n.playerInside?"OI":"OO"}const ne=[0,3,5,6,9,12],te=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],se=({seed:l,day:a,startingConfig:o=[],baseUpgradeChance:n=0,blueprintCount:t=5,searchDepth:s=2,ghostBlueprints:p=2,blueprintCabinets:I=1,solo:m,cards:C=[],appliances:O=[],simpleBPSettings:h=!1})=>{var u,g,N;l=l.toLocaleLowerCase().trim();const c={blueprintCount:t+p,spawnInside:!0},d=new j(l,n),S=t===7;let D=[];const T=S?te:ne;{let r=0;for(const b of T){if(b>a){console.log(`added up to card ${r}: ${C.slice(0,r).map(x=>x.Name).join(", ")}`);break}b===a?(D.push(C[r]),d.handleNewCardSpawnEffects(C[r])):d.addCard(C[r]),r++}}d.OwnedAppliances=[...d.OwnedAppliances,...O];const w=[],v=[];for(let r=-I-1;r<=I;r++){const b={spawnInside:!0,blueprintCount:t+r};r===0&&v.push(b),w.push(b),h!=="insideOnly"&&(r===0&&(v.push({spawnInside:!1,playerInside:!0,blueprintCount:t+r}),v.push({spawnInside:!1,playerInside:!1,blueprintCount:t+r})),m||w.push({spawnInside:!1,playerInside:!0,blueprintCount:t+r}),w.push({spawnInside:!1,playerInside:!1,blueprintCount:t+r}))}let k=[],i=[o];for(let r=0;r<=s;r++){if(r)for(const f of D)d.handleNewCardRerollEffects(f);let b=[],x=[];for(let f=0;f<i.length;f++){const B={...c};B.blueprintCount=i[f].length?(((u=i[f].at(-1))==null?void 0:u.blueprintCount)??t)+p:t;const F=d.getAppliances([...i[f],B],a).map(A=>A.Name),K=h==="noSwitching"?m||(N=(g=i[f])==null?void 0:g[0])!=null&&N.spawnInside?w.length/(m?2:3):w.length*2/3:w.length;x.push(e("td",{class:"reroll-cell "+ee(i[f],h,m),colspan:K**(s-r),children:[e(q,{bps:F,ghostCount:r===0?0:p}),Z(i[f])]}));const L=o.length+r===0?v:w;for(const A of L){const P=[...i[f]];h==="noSwitching"&&P.length&&P[0].spawnInside!==A.spawnInside||(P.push(A),b.push(P))}}k.push(e("tr",{children:[e("td",{children:r?`Reroll ${r}`:"Spawns"}),x]})),i=b}return e("table",{children:[" ",k," "]})},le=({onConfigChange:l,config:a})=>{const{seed:o,day:n,blueprintCount:t,solo:s,appliances:p=$,cards:I,searchDepth:m,simpleBPSettings:C=!1}=a,O=c=>{let d={...a};c.target.checked?(d.blueprintCount=7,d.baseUpgradeChance=.25):(d.blueprintCount=5,d.baseUpgradeChance=0),l(d)},h=(c,d)=>{let S={...a};S[c]=d,l(S)};return e("div",{children:[e("div",{children:[e("div",{children:"Run Config:"}),e("label",{for:"solo",children:"Solo:"}),e("input",{type:"checkbox",id:"solo",checked:s,onChange:()=>{h("solo",!s)}}),e("span",{style:"margin:0 20px",children:[e("label",{for:"simpleRerollSettings",children:"Spawn setting configs: "}),e("select",{value:C===!0?"insideOnly":C===!1?"full":C,onChange:c=>{var d;h("simpleBPSettings",((d=c.target)==null?void 0:d.value)??"full")},children:[e("option",{value:"full",children:"All spawn settings"}),e("option",{value:"insideOnly",children:"Spawn Inside only"}),e("option",{value:"noSwitching",children:"Don't switch bp settings after spawn"})]})]}),e("div",{children:[e("label",{for:"searchDepth",children:"Number of Rerolls"})," ",e("input",{id:"searchDepth",type:"number",value:m,onChange:c=>{h("searchDepth",Number(c.target.value))}})]}),e("label",{for:"seed",value:o,children:["Seed:"," "]}),e("input",{type:"text",id:"seed",value:o,onChange:c=>{h("seed",c.target.value)}}),e("label",{for:"setting",children:" Turbo?"}),e("input",{id:"setting",type:"checkbox",checked:t===7,onChange:O})]}),e("div",{children:[e("label",{for:"day",value:n,children:["Prep of Day:"," "]}),e("input",{type:"number",id:"day",value:n+1,onChange:c=>{h("day",Number(c.target.value)-1)}}),e(z,{id:"cardSchedule",label:"Enter all cards in order, including your starting dish:",onSelectionChange:c=>{h("cards",c.cards)},showSelectionMode:!1,cards:I,include:!0,modes:["themes","dishes","customerCards"]}),e(X,{label:"Select owned appliances:",placeholder:"",onSelectionChange:c=>{h("appliances",c)},appliances:p})]})]})},ae={seed:"az",day:2,cards:[],initialRerollConfig:[],blueprintCount:5,baseUpgradeChance:0,solo:!1,appliances:$,searchDepth:2,simpleBPSettings:!1},de=()=>{const[l,a]=W(ae,"BRANCH_CONFIG",t=>{if(typeof t.simpleBPSettings=="boolean"){debugger;return{...t,simpleBPSettings:t.simpleBPSettings?"insideOnly":"full"}}return t}),[o,n]=G();return H(()=>{o.has("cards")&&(a(t=>({...t,seed:o.get("seed")??t.seed,cards:o.get("cards").split(",").map(s=>M.filter(p=>p.Name===s)[0]),blueprintCount:o.get("turbo")?7:5,baseUpgradeChance:o.get("turbo")?.25:0,solo:!!Number(o.get("solo"))})),n(new URLSearchParams,{replace:!0}))},[o]),e(_,{children:[e("div",{children:["Hover over a cell for instructions on how to get those blueprints. Getting the blueprints in grey requires taking extra blueprints out of cabinets."," ",e("span",{style:"font-size:small",children:"(Rerolls are inaccurate if you bought a blueprint desk)"})]}),e(le,{onConfigChange:a,config:l}),e(se,{...l,blueprintCabinets:1}),!1]})};export{de as default};
