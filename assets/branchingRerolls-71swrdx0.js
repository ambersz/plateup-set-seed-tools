import{A as U,h as E,F as V,u as e,a as G,p as M,U as H,g as _,b as j}from"./main-X2I0Few7.js";import{G as q}from"./GhostBlueprints-d7Qokwwq.js";import{u as k,a as I,U as z}from"./UnlockSelect-K1Eg6Zv9.js";import{u as W}from"./usePersistentState-qUBdxTkH.js";const J=[...U];function Q(s,a,o){const n=a.toLowerCase();return J.filter(function(l){return!s.some(g=>g.ID===l.ID)&&l.Name.toLowerCase().includes(n)&&(!o||l.StapleWhenMissing||l.SellOnlyAsUnique)}).sort((t,l)=>t.Name<l.Name?-1:1)}function X({onSelectionChange:s,label:a,placeholder:o,include:n=!0,appliances:t=[],stapleRelatedOnly:l=!0}){const[g,y]=E(""),m=V(()=>Q(t,g,l),[t,g]),{getSelectedItemProps:C,getDropdownProps:O,removeSelectedItem:u}=k({selectedItems:t,onStateChange({selectedItems:r,type:p}){switch(p){case k.stateChangeTypes.SelectedItemKeyDownBackspace:case k.stateChangeTypes.SelectedItemKeyDownDelete:case k.stateChangeTypes.DropdownKeyDownBackspace:case k.stateChangeTypes.FunctionRemoveSelectedItem:s(r??[]);break}}}),{isOpen:c,getToggleButtonProps:d,getLabelProps:S,getMenuProps:x,getInputProps:B,highlightedIndex:b,getItemProps:v,selectedItem:D}=I({items:m,itemToString(r){return r?r.Name:""},defaultHighlightedIndex:-1,selectedItem:null,inputValue:g,stateReducer(r,p){const{changes:h,type:N}=p;switch(N){case I.stateChangeTypes.InputChange:return p.inputValue?{...h,highlightedIndex:0}:{...h,highlightedIndex:-1};case I.stateChangeTypes.InputKeyDownEnter:return{...h,isOpen:!1,highlightedIndex:-1};case I.stateChangeTypes.ItemClick:return{...h,isOpen:!0,highlightedIndex:-1};default:return h}},onStateChange({inputValue:r,type:p,selectedItem:h}){switch(p){case I.stateChangeTypes.InputKeyDownEnter:case I.stateChangeTypes.ItemClick:case I.stateChangeTypes.InputBlur:h&&(s([...t,h]),y(""));break;case I.stateChangeTypes.InputChange:y(r??"");break}}});return e("div",{className:"combo-container",children:[e("div",{className:"",children:[e("label",{className:"",...S(),children:a??"Select desired cards"}),e("div",{className:"",children:[t.map(function(p,h){return e("span",{className:"selected-items"+(n?" include":" exclude"),...C({selectedItem:p,index:h}),children:[p.Name,e("span",{class:"x",onClick:N=>{N.stopPropagation(),u(p)},children:"âœ•"})]},`selected-item-${h}`)}),e("div",{className:"",children:e("input",{placeholder:o??"Card Selection(s)",className:"",...B(O({preventKeyAction:c}))})})]})]}),e("ul",{className:`dropdown ${c&&m.length?"":"hidden"}`,...x(),children:[!1,c&&m.map((r,p)=>e("li",{className:Y(b===p&&"bg-blue-300",D===r&&"font-bold","py-2 px-3 shadow-sm flex flex-col"),...v({item:r,index:p}),children:e("span",{children:r.Name})},`${r.ID}${p}`))]})]})}const Y=(...s)=>s.filter(a=>a).join(" ");function Z(s){let a="";if(!s.length)a="Spawn: any settings";else{for(let n=0;n<s.length;n++){const t=s[n];let l=n?`Reroll ${n}`:"Spawn";l+=": ",l+="Blueprints "+(t.spawnInside?"Spawn Inside":"Spawn Outside, "+(t.playerInside?"Someone Inside":"All Players Stand Outside")),n&&(l+=`, reroll ${s[n].blueprintCount} blueprints`),a+=l+`
`}a+=`Reroll ${s.length}: any settings`}const o=a.split(`
`);return e("div",{class:"reroll-instructions",onClick:n=>{if(n.detail<2)return;const t=document.createRange();t.selectNodeContents(n.currentTarget);const l=document.getSelection();l==null||l.removeAllRanges(),l==null||l.addRange(t)},children:o.map(n=>e("div",{children:n}))})}const $=U.filter(s=>s.Name==="Booking Desk"||s.Name==="Blueprint Cabinet").sort((s,a)=>s.Name<a.Name?1:-1);function ee(s,a,o){const n=s.at(-1);if(a==="insideOnly"||o&&a==="noSwitching"||a==="noSwitching"&&(n!=null&&n.spawnInside))switch(((n==null?void 0:n.blueprintCount)??0)%3){case 0:return"I";case 1:return"OI";default:return"OO"}return n!=null&&n.spawnInside?"I":n!=null&&n.playerInside?"OI":"OO"}const ne=[0,3,5,6,9,12],te=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],se=({seed:s,day:a,startingConfig:o=[],baseUpgradeChance:n=0,blueprintCount:t=5,searchDepth:l=2,ghostBlueprints:g=2,blueprintCabinets:y=1,solo:m,cards:C=[],appliances:O=[],simpleBPSettings:u=!1})=>{var p,h,N;s=s.toLocaleLowerCase().trim();const c={blueprintCount:t+g,spawnInside:!0},d=new j(s,n),S=t===7;let x=[];const B=S?te:ne;{let i=0;for(const w of B){if(w>a){console.log(`added up to card ${i}: ${C.slice(0,i).map(R=>R.Name).join(", ")}`);break}w===a?(x.push(C[i]),d.handleNewCardSpawnEffects(C[i])):d.addCard(C[i]),i++}}d.OwnedAppliances=[...d.OwnedAppliances,...O];const b=[],v=[];for(let i=-y-1;i<=y;i++){const w={spawnInside:!0,blueprintCount:t+i};i===0&&v.push(w),b.push(w),u!=="insideOnly"&&(i===0&&(v.push({spawnInside:!1,playerInside:!0,blueprintCount:t+i}),v.push({spawnInside:!1,playerInside:!1,blueprintCount:t+i})),m||b.push({spawnInside:!1,playerInside:!0,blueprintCount:t+i}),b.push({spawnInside:!1,playerInside:!1,blueprintCount:t+i}))}let D=[],r=[o];for(let i=0;i<=l;i++){if(i)for(const f of x)d.handleNewCardRerollEffects(f);let w=[],R=[];for(let f=0;f<r.length;f++){const A={...c};A.blueprintCount=r[f].length?(((p=r[f].at(-1))==null?void 0:p.blueprintCount)??t)+g:t;const F=d.getAppliances([...r[f],A],a).map(P=>P.Name),K=u==="noSwitching"?m||(N=(h=r[f])==null?void 0:h[0])!=null&&N.spawnInside?b.length/(m?2:3):b.length*2/3:b.length;R.push(e("td",{class:"reroll-cell "+ee(r[f],u,m),colspan:K**(l-i),children:[e(q,{bps:F,ghostCount:i===0?0:g}),Z(r[f])]}));const L=o.length+i===0?v:b;for(const P of L){const T=[...r[f]];u==="noSwitching"&&T.length&&T[0].spawnInside!==P.spawnInside||(T.push(P),w.push(T))}}D.push(e("tr",{children:[e("td",{children:i?`Reroll ${i}`:"Spawns"}),R]})),r=w}return e("table",{children:[" ",D," "]})},le=({onConfigChange:s,config:a})=>{const{seed:o,day:n,blueprintCount:t,solo:l,appliances:g=$,cards:y,searchDepth:m,simpleBPSettings:C=!1}=a,O=c=>{let d={...a};c.target.checked?(d.blueprintCount=7,d.baseUpgradeChance=.25):(d.blueprintCount=5,d.baseUpgradeChance=0),s(d)},u=(c,d)=>{let S={...a};S[c]=d,s(S)};return e("div",{children:[e("div",{children:[e("div",{children:"Run Config:"}),e("label",{for:"solo",children:"Solo:"}),e("input",{type:"checkbox",id:"solo",checked:l,onChange:()=>{u("solo",!l)}}),e("span",{style:"margin:0 20px",children:[e("label",{for:"simpleRerollSettings",children:"Spawn setting configs: "}),e("select",{value:C===!0?"insideOnly":C===!1?"full":C,onChange:c=>{var d;u("simpleBPSettings",((d=c.target)==null?void 0:d.value)??"full")},children:[e("option",{value:"full",children:"All spawn settings"}),e("option",{value:"insideOnly",children:"Spawn Inside only"}),e("option",{value:"noSwitching",children:"Don't switch bp settings after spawn"})]})]}),e("div",{children:[e("label",{for:"searchDepth",children:"Number of Rerolls"})," ",e("input",{id:"searchDepth",type:"number",value:m,onChange:c=>{u("searchDepth",Number(c.target.value))}})]}),e("label",{for:"seed",value:o,children:["Seed:"," "]}),e("input",{type:"text",id:"seed",value:o,onChange:c=>{u("seed",c.target.value)}}),e("label",{for:"setting",children:" Turbo?"}),e("input",{id:"setting",type:"checkbox",checked:t===7,onChange:O})]}),e("div",{children:[e("label",{for:"day",value:n,children:["Prep of Day:"," "]}),e("input",{type:"number",id:"day",value:n+1,onChange:c=>{u("day",Number(c.target.value)-1)}}),e(z,{id:"cardSchedule",label:"Enter all cards in order, including your starting dish:",onSelectionChange:c=>{u("cards",c.cards)},showSelectionMode:!1,cards:y,include:!0,modes:["themes","dishes","customerCards"]}),e(X,{label:"Select owned appliances:",placeholder:"",onSelectionChange:c=>{u("appliances",c)},appliances:g})]})]})},ae={seed:"az",day:2,cards:[],initialRerollConfig:[],blueprintCount:5,baseUpgradeChance:0,solo:!1,appliances:$,searchDepth:2,simpleBPSettings:!1},de=()=>{const[s,a]=W(ae,"BRANCH_CONFIG",t=>{if(typeof t.simpleBPSettings=="boolean"){debugger;return{...t,simpleBPSettings:t.simpleBPSettings?"insideOnly":"full"}}return t}),[o,n]=G();return M(()=>{o.has("cards")&&(a(t=>({...t,seed:o.get("seed")??t.seed,cards:o.get("cards").split(",").map(l=>H.filter(g=>g.Name===l)[0]),blueprintCount:o.get("turbo")?7:5,baseUpgradeChance:o.get("turbo")?.25:0,solo:!!Number(o.get("solo"))})),n(new URLSearchParams,{replace:!0}))},[o]),e(_,{children:[e("div",{children:"Hover over a cell for instructions on how to get those blueprints. Getting the blueprints in grey requires taking extra blueprints out of cabinets"}),e(le,{onConfigChange:a,config:s}),e(se,{...s,blueprintCabinets:1}),!1]})};export{de as default};
