import{a as q}from"./usePersistentState-C43OC5NU.js";import{k as v,l as C,o as R,u as e,L as I,g as S}from"./main-CWEgBwrP.js";const O=["0nwgp558","2lg135el","wlekw94l","6njy11vn","wl3d19v8"],_={"9qj3rrgl":"Set Seed",jq6dmm71:"Random Seed","5lm5yy4q":"Breakfast","81wygg5q":"Burgers","139xem31":"Cakes",q752kvp1:"Coffee","0q53pe71":"Dumplings",zqo40021:"Fish","013g003l":"Hot Dogs",rqv877w1:"Pies","5lejooz1":"Pizza","0q5r66n1":"Salad",q8kenokq:"Spaghetti","4lxnzzr1":"Steak","814zjjjl":"Stir Fry",qyz46g41:"Tacos",jqz3yeg1:"Turkey",z19n33kq:"Solo",p127nnkq:"Duo","81p9jjkq":"Trio",xqkvddyl:"Quad",lx5gv6r1:"Pre 1.1.6b","14o95wjq":"1.1.6b ",q8k48jgq:"1.1.7-1.1.9",q5v5kj2l:"1.2.0+",qvvx3vrq:"Normal","139x39r1":"Autumn","192x6ykq":"Turbo",q5v4kv7l:"Lake",le2nd2ml:"North Pole",qoxjdx5q:"Halloween"},w=({run:n})=>e(S,{children:[e("a",{href:n.weblink,children:n.primary})," by"," ",n.players.map(i=>i.weblink?e(S,{children:[e("a",{href:i.weblink,children:i.name})," "]}):e(S,{children:[i.name," "]})),"(",n.category[0],")"]}),F=()=>{const n=q("","OPPORTUNITY_OLDEST_UNVERIFIED_ID"),i=q([],"OPPORTUNITY_RUNS_CACHE"),t=v({}),m=v("Pre 1.1.6b"),g=v(!1),h=v(!1);C(()=>{if(Object.keys(t.peek()).length)return;let d=Object.assign({},t.peek());for(const s of i.value){const c=k(s);s.status==="verified"&&s.primary_t<(d[c]??1/0)&&(d[c]=s.primary_t)}t.value=d});const l=R(()=>{const d=n.value,s=Object.assign({},t.value),c=i.value;return()=>{h.value=!0,T(d).then(p=>{let r="";for(const a of p){const f=k(a);a.status==="verified"&&a.primary_t<(s[f]??1/0)&&(s[f]=a.primary_t)}const o=[],u={};for(const a of p){const f=k(a);a.status==="new"&&(r=a.id),a.primary_t<=(s[f]??1/0)&&(o.push(a),u[a.id]=!0)}for(const a of c){if(u[a.id])continue;const f=k(a);a.primary_t<=(s[f]??1/0)&&o.push(a)}i.value=o,t.value=s,n.value=r,h.value=!1})}}),b=R(()=>{var p;let d=[];const s=[],c={"Set Seed":{},"Random Seed":{}};for(const r of i.value){if(r.status==="rejected"||r.status!=="verified"&&g.value||!P(r.category[0],m.value))continue;const o=r.category.slice(2).join(" "),u=r.category[1];r.primary_t<(((p=c[u][o])==null?void 0:p.primary_t)??1/0)&&(c[u][o]=r)}for(const r of Object.keys(c["Random Seed"])){const o=c["Set Seed"][r],u=c["Random Seed"][r];if(((o==null?void 0:o.primary_t)??1/0)<u.primary_t)continue;let a="../normal-seed-searcher.html";r.includes(" Lake ")?a="https://steamcommunity.com/sharedfiles/filedetails/?id=2932253817":r.includes(" Turbo ")&&(a="../turbo-seed-searcher.html");const f=o?o.primary_t/u.primary_t:1/0;s.push(r),d.push([e("tr",{id:r,children:[e("td",{children:[r," ",e(I,{to:a,children:"Searcher"})]}),e("td",{children:o?" "+(f*100).toFixed(2)+"%":""}),e("td",{children:o?e(w,{run:o}):"No Set Seed Run"}),e("td",{children:e(w,{run:u})})]}),f])}return[d.sort((r,o)=>-o[1]+r[1]).map(r=>r[0]),s]}),y=v(""),x=R(()=>()=>{y.value=b.value[1][Math.floor(Math.random()*b.value[1].length)]});return e("div",{children:[e("style",{children:`[id="${y.value}"] {border: rgb(var(--color)) 3px solid;}`}),e("h2",{children:"Set Seed Opportunities"}),e("div",{children:"Categories where the set seed record is not faster than the random seed record, or there is no set seed run at all."}),e("pre",{children:"// TODO: autofill starting cards in searcher link: dish + Autumn-Community & North Pole-Christmas Rush"}),e("button",{onClick:l.value,disabled:h,children:h.value?"Fetching Data...":i.value.length?"Update Run Data":"Fetch All Runs"}),e("div",{children:[e("button",{onClick:x.value,children:"Pick Random Category"})," ",y.value&&e("a",{href:"",onClick:d=>{var s;d.preventDefault(),(s=document.getElementById(y.value))==null||s.scrollIntoView()},children:y})]}),e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Category"}),e("th",{children:"Ratio"}),e("th",{children:"Fastest Seeded Run"}),e("th",{children:"Fastest Unseeded Run"})]})}),e("tbody",{children:b.value[0]})]})]})};function k(n){return n.category.join(",")}const j=["Pre 1.1.6b","1.1.6b","1.1.7-1.1.9","1.2.0+"];function P(n,i){return j.indexOf(n)>=j.indexOf(i)}async function T(n){let i=[],t=0;e:for(;;){const g=await(await fetch(`https://www.speedrun.com/api/v1/runs?orderby=submitted&direction=desc&game=yd4kq3k6&category=z275n0gk&max=200&embed=players&offset=${t}`)).json(),h=g.data;for(let l=0;l<h.length;l++)if(i.push(h[l]),h[l].id===n)break e;if(!g.pagination.links.some(l=>l.rel==="next"))break;await new Promise(l=>{setTimeout(()=>{l(!0)},60*1e3/100)}),t+=200}return i.map(m=>z(m))}function z(n){const i={id:n.id,category:O.map(t=>_[n.values[t]]),weblink:n.weblink,primary:n.times.primary.split(/[a-z]+/i).filter(t=>t).map((t,m)=>m?t.padStart(2,"0"):t).join(":"),primary_t:n.times.primary_t,players:n.players.data.map(t=>t.rel==="guest"?{name:t.name}:{name:t.names.international,weblink:t.weblink}),status:n.status.status};return i.category[3]===void 0&&(i.category[3]="Normal"),i.category.some(t=>t===void 0)&&alert("go tell ambersz to actually pull the variable data from the API instead of hardcoding it..."),i}export{F as default};
