import{a as q}from"./usePersistentState-CvwtuqA8.js";import{k as v,l as x,o as R,u as e,L as I,g as S}from"./main-CpO9Gw3m.js";const O=["0nwgp558","2lg135el","wlekw94l","6njy11vn","wl3d19v8"],_={"9qj3rrgl":"Set Seed",jq6dmm71:"Random Seed","5lm5yy4q":"Breakfast","81wygg5q":"Burgers","139xem31":"Cakes",q752kvp1:"Coffee","0q53pe71":"Dumplings",zqo40021:"Fish","013g003l":"Hot Dogs",rqv877w1:"Pies","5lejooz1":"Pizza","0q5r66n1":"Salad",q8kenokq:"Spaghetti","4lxnzzr1":"Steak","814zjjjl":"Stir Fry",qyz46g41:"Tacos",jqz3yeg1:"Turkey",z19n33kq:"Solo",p127nnkq:"Duo","81p9jjkq":"Trio",xqkvddyl:"Quad",lx5gv6r1:"Pre 1.1.6b","14o95wjq":"1.1.6b ",q8k48jgq:"1.1.7-1.1.9",q5v5kj2l:"1.2.0+",qvvx3vrq:"Normal","139x39r1":"Autumn","192x6ykq":"Turbo",q5v4kv7l:"Lake",le2nd2ml:"North Pole",qoxjdx5q:"Halloween"},w=({run:n})=>e(S,{children:[e("a",{href:n.weblink,children:n.primary})," by"," ",n.players.map(t=>t.weblink?e(S,{children:[e("a",{href:t.weblink,children:t.name})," "]}):e(S,{children:[t.name," "]})),"(",n.category[0],")"]}),U=()=>{const n=q("","OPPORTUNITY_OLDEST_UNVERIFIED_ID"),t=q([],"OPPORTUNITY_RUNS_CACHE"),r=v({}),l=v("Pre 1.1.6b"),y=v(!1),m=v(!1);x(()=>{if(Object.keys(r.peek()).length)return;let c=Object.assign({},r.peek());for(const s of t.value){const u=k(s);s.status==="verified"&&s.primary_t<(c[u]??1/0)&&(c[u]=s.primary_t)}r.value=c});const d=R(()=>{const c=n.value,s=Object.assign({},r.value),u=t.value;return()=>{m.value=!0,T(c).then(g=>{let i="";for(const a of g){const h=k(a);a.status==="verified"&&a.primary_t<(s[h]??1/0)&&(s[h]=a.primary_t)}const o=[],f={};for(const a of g){const h=k(a);a.status==="new"&&(i=a.id),a.primary_t<=(s[h]??1/0)&&(o.push(a),f[a.id]=!0)}for(const a of u){if(f[a.id])continue;const h=k(a);a.primary_t<=(s[h]??1/0)&&o.push(a)}t.value=o,r.value=s,n.value=i,m.value=!1})}}),b=R(()=>{var g;let c=[];const s=[],u={"Set Seed":{},"Random Seed":{}};for(const i of t.value){if(i.status==="rejected"||i.status!=="verified"&&y.value||!P(i.category[0],l.value))continue;const o=i.category.slice(2).join(" "),f=i.category[1];i.primary_t<(((g=u[f][o])==null?void 0:g.primary_t)??1/0)&&(u[f][o]=i)}for(const i of Object.keys(u["Random Seed"])){const o=u["Set Seed"][i],f=u["Random Seed"][i];if(((o==null?void 0:o.primary_t)??1/0)<f.primary_t)continue;let a="../normal-seed-searcher.html";i.includes(" Lake ")?a="https://steamcommunity.com/sharedfiles/filedetails/?id=2932253817":i.includes(" Turbo ")&&(a="../turbo-seed-searcher.html");const h=o?o.primary_t/f.primary_t:1/0;s.push(i),c.push([e("tr",{id:i,children:[e("td",{children:[i," ",e(I,{to:a,children:"Searcher"})]}),e("td",{children:o?" "+(h*100).toFixed(2)+"%":""}),e("td",{children:o?e(w,{run:o}):"No Set Seed Run"}),e("td",{children:e(w,{run:f})})]}),h])}return[c.sort((i,o)=>-o[1]+i[1]).map(i=>i[0]),s]}),p=v(""),C=R(()=>()=>{p.value=b.value[1][Math.floor(Math.random()*b.value[1].length)]});return e("div",{children:[e("style",{children:`[id="${p.value}"] {border: rgb(var(--color)) 3px solid;}`}),e("h2",{children:"Set Seed Opportunities"}),e("div",{children:"Categories where the set seed record is not faster than the random seed record, or there is no set seed run at all."}),e("pre",{children:"// TODO: autofill starting cards in searcher link: dish + Autumn-Community & North Pole-Christmas Rush"}),e("button",{onClick:d.value,disabled:m,children:m.value?"Fetching Data...":t.value.length?"Update Run Data":"Fetch All Runs"}),e("div",{children:[e("button",{onClick:C.value,children:"Pick Random Category"})," ",p.value&&e("a",{href:"",onClick:c=>{var s;c.preventDefault(),(s=document.getElementById(p.value))==null||s.scrollIntoView()},children:p})]}),e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Category"}),e("th",{children:"Ratio"}),e("th",{children:"Fastest Seeded Run"}),e("th",{children:"Fastest Unseeded Run"})]})}),e("tbody",{children:b.value[0]})]})]})};function k(n){return n.category.join(",")}const j=["Pre 1.1.6b","1.1.6b","1.1.7-1.1.9","1.2.0+"];function P(n,t){return j.indexOf(n)>=j.indexOf(t)}async function T(n){let t=[],r=0;e:for(;;){const y=await(await fetch(`https://www.speedrun.com/api/v1/runs?orderby=submitted&direction=desc&game=yd4kq3k6&category=z275n0gk&max=200&embed=players&offset=${r}`)).json(),m=y.data;for(let d=0;d<m.length;d++)if(t.push(m[d]),m[d].id===n)break e;if(!y.pagination.links.some(d=>d.rel==="next"))break;await new Promise(d=>{setTimeout(()=>{d(!0)},60*1e3/100)}),r+=200}return t.map(l=>z(l))}function z(n){const t={id:n.id,category:O.map(r=>_[n.values[r]]),weblink:n.weblink,primary:D(n),primary_t:n.times.primary_t,players:n.players.data.map(r=>r.rel==="guest"?{name:r.name}:{name:r.names.international,weblink:r.weblink}),status:n.status.status};return t.category[3]===void 0&&(t.category[3]="Normal"),t.category.some(r=>r===void 0)&&alert("go tell ambersz to actually pull the variable data from the API instead of hardcoding it..."),t}function D(n){const t=n.times.primary.split(/[a-z.]+/i).filter(l=>l).map((l,y)=>y?l.padStart(2,"0"):l);let r=t[0];for(let l=1;l<t.length;l++)t[l].length===3?r+=".":r+=":",r+=t[l];return r}export{U as default};
