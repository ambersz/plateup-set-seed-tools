var C=Object.defineProperty;var b=(o,e,t)=>e in o?C(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var a=(o,e,t)=>(b(o,typeof e!="symbol"?e+"":e,t),t);import{a as D,D as m,F as p,b as S,u as l,L as k}from"./main-nVfmSndt.js";class y{constructor(e,t=[],s=[]){a(this,"seed");a(this,"mapSize");a(this,"frontDoor");a(this,"startingCards");a(this,"cards");a(this,"playerCount");a(this,"turbo");a(this,"_cardsByDay",[]);this.seed=e,this.mapSize=this.getMapSize(),this.frontDoor=this.getDoorInfo(),this.startingCards=t,this.cards=s,this.playerCount=this.mapSize,this.turbo=this.startingCards.some(r=>{if(r===void 0){console.log({startingCards:t});debugger}return r.Name==="Turbo"})}guessMoney(e){if(e===0)return this.turbo?30:0;const t=this.getCustomerCount(e);let s=this.startingCards.reduce((r,i)=>r+i.DishValue,0);if(this.getCardsByDay(e).some(r=>r.Name==="Double Helpings")&&(s+=3),Number.isNaN(t))debugger;if(Number.isNaN(s))debugger;return M(this.playerCount)*(t*s+this.getBookingDeskCount(e)*this.getBookingDeskMoney(e))}getBookingDeskMoney(e){return Math.ceil((e+1)/2)+2}getCardsByDay(e){if(this._cardsByDay[e]===void 0){let t;this.turbo?t=e-1:(t=Math.max(0,Math.floor((e-1)/3)),e>5&&t++),this._cardsByDay[e]=[...this.startingCards,...this.cards.slice(0,t)],console.log(`Day ${e} has ${this._cardsByDay[e].map(s=>s.Name).join(", ")}`)}return this._cardsByDay[e]}getBookingDeskCount(e){return Math.ceil(this.getExpectedCustomers(e)/this.getExpectedGroupSize(e))+(this.turbo?3:this.getCardsByDay(e).filter(t=>t.Name.includes(" Rush")).length)}getGroupCount(e){const t=this.getExpectedCustomers(e),s=this.getCardsByDay(e).filter(n=>n.Name==="Closing Time").length*.2,r=this.getExpectedGroupSize(e),i=t*(1+s)/r;return console.log({custs:t,closingTimeAdjust:s,avgGroupSize:r,goalGroups:i}),Math.ceil(i)}getCustomerCount(e){return this.getGroupSizes(e).reduce((t,s)=>t+s,0)}getGroupSizes(e){const t=D(1997821,e,this.seed).random,s=this.getGroupCount(e),r=this.getCardsByDay(e).some(h=>h.Name==="Herd Mentality");let i=s,n=[],[u,c]=this.getGroupSizeRange(e);console.log({min:u,max:c,gc:s,herd:r});{let h=i-1;for(;h--;)t.value}for(;i--;)n.push(t.range(u,c+1)),!r&&i!==s-1&&t.value;let g=this.turbo?3:this.getCardsByDay(e).filter(h=>h.Name.includes(" Rush")).length;const f=Math.ceil(Math.max(1,this.getExpectedCustomers(e)*.15));let d=g*f;for(console.log({totalRushGroups:d});d--;)n.push(t.range(u,c+1));return console.log({groups:n}),n}getExpectedGroupSize(e){const t=this.getGroupSizeRange(e);return(t[0]+t[1])/2}getGroupSizeRange(e){let t=1,s=2;for(const r of this.getCardsByDay(e))switch(r.Name){case"Individual Dining":s--;break;case"Medium Groups":t++,s+=2;break;case"Large Groups":t+=2,s+=2;break;case"Flexible Dining":t--,s++;break;case"Community":const i=Math.floor((e-1)/3);t+=i,s+=i;break}return[t,s]}getExpectedCustomers(e){const t=this.getReductions(e),s=this.getDayLength(e),r=this.getPlayerModifier(),i=this.getCourseModifier(e),n=this.getDayRate(e),u=this.getCustomersPerHour(e),c=this.getAdvertisingModifier(e),g=.85**t*(s/25*n*r)/i*u*c;return console.log({reductions:t,dayLength:s,playerModifier:r,courseModifier:i,dayRate:n,kitchenParamCustomers:u,advertising:c,res:g}),g}getAdvertisingModifier(e){return 1+.25*this.getCardsByDay(e).filter(s=>s.Name==="Advertising").length}getDayRate(e){let t=1;switch(e){case 1:t=1.25;break;case 2:t=1.5;break;default:t=1.5+.15*(e-3);break}return e>15&&(t+=(this.turbo?.1:0)*(e-15)**1.5),t}getCourseModifier(e){let t=1;const s=this.getCardsByDay(e);return s.some(r=>r.DishType===m.Dessert)&&(t+=.25),s.some(r=>r.DishType===m.Starter)&&(t+=.25),t}getPlayerModifier(){let e;switch(this.playerCount){case 0:e=1;break;case 1:e=.8;break;case 2:e=1;break;case 3:e=1.25;break;default:e=1.5;break}return e}getDayLength(e){return 100+Math.floor(e/3)*25}getCustomersPerHour(e){let t=1;return this.turbo&&(t=1.5,t*=1+e/10),t}getReductions(e){return this.getCardsByDay(e).reduce((s,r)=>s+r.CustomerMultiplier,0)}getMapSize(){const t=new p(this.seed,5078598).useSubcontext(0).random.range(0,4);let s;switch(t){case 0:s=2;break;case 1:s=1;break;case 2:s=3;break;case 3:s=4;break;default:throw new Error}return s}getDoorInfo(){if(this.mapSize!==1)return-1;let e=new S(new p(this.seed,98234234).useSubcontext(0).random.value),t=23;for(;t--;)e.value;return e.range(0,4)}}function M(o){switch(o){case 1:return 1.25;case 2:return 1.1;default:return 1}}const x=({turbo:o=!1,result:e,door:t=!1})=>l("div",{children:[e.seed,e.mapSize&&` (${e.mapSize}${t?`, ${new y(e.seed).frontDoor}`:""})`,":"," ",l("div",{children:[e.cards.join(", "),l(k,{to:`../branching-rerolls.html?${o?"turbo=1&":""}&seed=${e.seed}&cards=${e.cards.map(s=>encodeURIComponent(s)).join(",")}&solo=${e.mapSize===1?1:0}`,children:" (Blueprints)"})]})]});export{x as S};
