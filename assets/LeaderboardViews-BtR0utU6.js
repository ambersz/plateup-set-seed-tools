import{a as I}from"./usePersistentState-DW_kTIkw.js";import{u as e,k as R,n as F,r as S,g as j,L as A}from"./main-DrYS2HM0.js";const L=["0nwgp558","2lg135el","wlekw94l","6njy11vn","wl3d19v8"],N={"9qj3rrgl":"Set Seed",jq6dmm71:"Random Seed","5lm5yy4q":"Breakfast","81wygg5q":"Burgers","139xem31":"Cakes",q752kvp1:"Coffee","0q53pe71":"Dumplings",zqo40021:"Fish","013g003l":"Hot Dogs",rqv877w1:"Pies","5lejooz1":"Pizza","0q5r66n1":"Salad",q8kenokq:"Spaghetti","4lxnzzr1":"Steak","814zjjjl":"Stir Fry",qyz46g41:"Tacos",jqz3yeg1:"Turkey",z19n33kq:"Solo",p127nnkq:"Duo","81p9jjkq":"Trio",xqkvddyl:"Quad",lx5gv6r1:"Pre 1.1.6b","14o95wjq":"1.1.6b ",q8k48jgq:"1.1.7-1.1.9",q5v5kj2l:"1.2.0+",qvvx3vrq:"Normal","139x39r1":"Autumn","192x6ykq":"Turbo",q5v4kv7l:"Lake",le2nd2ml:"North Pole",qoxjdx5q:"Halloween"},_=({run:i})=>e(j,{children:[e("a",{href:i.weblink,children:i.primary})," by"," ",i.players.map(a=>a.weblink?e(j,{children:[e("a",{href:a.weblink,children:a.name})," "]}):e(j,{children:[a.name," "]})),"(",i.category[0],")"]});function U(i){const a=i.category.slice(1);let r=[[]];for(let y=a[0]==="Set Seed"?1:0;y<a.length-1;y++)r=r.flatMap(d=>[d,[...d,a[y]]]);const l=i.category[4],m=[];switch(l){case"Tacos":case"Cakes":case"Coffee":break;default:m.push("Plated");break}return m.push(l),r=r.flatMap(y=>{let d=m.map(q=>[...y,q]);return[y,...d]}),r[0]=["All Runs"],r}const Y=()=>e(T,{viewType:0}),$=()=>e(T,{viewType:1}),T=({viewType:i=2})=>{var O,x;const a=I("","OPPORTUNITY_OLDEST_UNVERIFIED_ID"),r=I([],"OPPORTUNITY_RUNS_CACHE"),l=R({}),m=R("Pre 1.1.6b"),y=R(!1),d=R(!1);F(()=>{if(Object.keys(l.peek()).length)return;let o=Object.assign({},l.peek());for(const f of r.value){const u=C(f);f.status==="verified"&&f.primary_t<(o[u]??1/0)&&(o[u]=f.primary_t)}const c=Array.from(new Set(Object.keys(o).map(f=>f.split(",").slice(1))));for(const f of c){let u=1/0;for(let s=g.length;s--;){const t=[g[s],...f].join(",");u=Math.min(o[t]??1/0,u),o[t]&&(o[t]=u)}}l.value=o});const q=S(()=>{const o=a.value,c=Object.assign({},l.value),f=r.value;return()=>{d.value=!0,V(o).then(u=>{let s="";for(const n of u){const p=C(n);if(n.status==="verified"&&n.primary_t<(c[p]??1/0)){c[p]=n.primary_t;for(const k of B(n))n.primary_t<(c[k]??1/0)&&(c[k]=n.primary_t)}}const t=[],h={};for(const n of u){const p=C(n);n.status==="new"&&(s=n.id),n.primary_t<=(c[p]??1/0)&&(t.push(n),h[n.id]=!0)}for(const n of f){if(h[n.id])continue;const p=C(n);n.primary_t<=(c[p]??1/0)&&t.push(n)}r.value=t,l.value=c,a.value=s,d.value=!1})}}),v=S(()=>{var s;let o=[],c=0;const f=[],u={"Set Seed":{},"Random Seed":{}};for(const t of r.value){if(t.status==="rejected"||t.status!=="verified"&&y.value||!P(t.category[0],m.value))continue;const h=t.category.slice(2).join(" "),n=t.category[1];t.primary_t<(((s=u[n][h])==null?void 0:s.primary_t)??1/0)&&(u[n][h]=t)}for(const t of Object.keys(u["Random Seed"])){const h=u["Set Seed"][t],n=u["Random Seed"][t];if(((h==null?void 0:h.primary_t)??1/0)<n.primary_t){c++;continue}let p="../normal-seed-searcher.html";t.includes(" Lake ")?p="https://steamcommunity.com/sharedfiles/filedetails/?id=2932253817":t.includes(" Turbo ")&&(p="../turbo-seed-searcher.html");const k=h?h.primary_t/n.primary_t:n.primary_t;f.push(t),o.push([e("tr",{id:t,children:[e("td",{children:[t," ",e(A,{to:p,children:"Searcher"})]}),e("td",{children:h?" "+(k*100).toFixed(2)+"%":""}),e("td",{children:h?e(_,{run:h}):"No Set Seed Run"}),e("td",{children:e(_,{run:n})})]}),k])}return[o.sort((t,h)=>-h[1]+t[1]).map(t=>t[0]),f,c]}),D=S(()=>{var u;const o={};for(const s of r.value){if(s.status==="rejected"||s.status!=="verified"&&y.value||!P(s.category[0],m.value))continue;const t=U(s);for(const h of t){const n=h.join(" ");(!o[n]||s.primary_t<o[n].primary_t)&&(o[n]=s)}}const c=new Map;for(const[s,t]of Object.entries(o))c.has(t)||c.set(t,[]),(u=c.get(t))==null||u.push(s);const f=Array.from(c.entries()).map(([s,t])=>[t.slice(0,-1).join(", "),s]);return f.sort((s,t)=>s[1].primary_t-t[1].primary_t),[f.map(([s,t])=>e("tr",{id:t.category.slice(1).join(" "),children:[e("td",{children:t.category.slice(1).join(" ")}),e("td",{children:e(_,{run:t})}),e("td",{children:s})]}))]}),b=R(""),z=S(()=>()=>{b.value=v.value[1][Math.floor(Math.random()*v.value[1].length)]});let w;switch(i){case 0:w=e(j,{children:[e("div",{children:[e("button",{onClick:z.value,children:"Pick Random Category"})," ",b.value&&e("a",{href:"",onClick:o=>{var c;o.preventDefault(),(c=document.getElementById(b.value))==null||c.scrollIntoView()},children:[e("br",{}),b]})]}),e("div",{children:[(x=(O=v==null?void 0:v.value)==null?void 0:O[1])==null?void 0:x.length," potential categories"," ",e("br",{}),v.value[2]," categories where set seed is already faster not shown"]}),e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Category"}),e("th",{children:"Ratio"}),e("th",{children:"Fastest Seeded Run"}),e("th",{children:"Fastest Unseeded Run"})]})}),e("tbody",{children:v.value[0]})]})]});break;case 1:w=e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Category"}),e("th",{children:"Record Run"}),e("th",{children:"Also the record run in these merged categories:"})]})}),e("tbody",{children:D.value[0]})]});break;case 2:w=e("table",{children:e("thead",{children:e("tr",{children:[e("th",{children:"Category"}),e("th",{children:"Linear Predicted"}),e("th",{children:"Linear Delta"}),e("th",{children:"Log Predicted"}),e("th",{children:"Log Delta"}),e("th",{children:"Record Run"})]})})})}return e("div",{children:[e("style",{children:`[id="${b.value}"] {border: rgb(var(--color)) 3px solid;}`}),i?e("div",{children:"Set seed opportunities (i.e. leaderboards where there is no set seed run, or the random seed record is faster than the set seed record)"}):e("div",{children:"View records of merged leaderboards (i.e. fastest Stir Fry run across all player counts and restaurant settings, or fastest PlateUp! run regardless of leaderboard category)"}),e("pre",{children:"// TODO: autofill starting cards in searcher link: dish + Autumn-Community & North Pole-Christmas Rush"}),e("button",{onClick:q.value,disabled:d,children:d.value?"Fetching Data...":r.value.length?"Update Run Data":"Fetch All Runs"}),e("br",{}),e("label",{for:"version",children:"Include runs dating back to:"}),e("select",{id:"version",value:m,onChange:o=>{m.value=o.target.value},children:g.map(o=>e("option",{value:o,children:o}))}),e("br",{}),e("label",{for:"verifiedOnly",children:"Verified Runs Only"}),e("input",{type:"checkbox",id:"verifiedOnly",checked:y,onChange:o=>{y.value=o.target.checked}}),w]})};function C(i){return i.category.join(",")}function B(i){let a=[];for(let r=g.indexOf(i.category[0])+1;r<g.length;r++)a.push([g[r],...i.category.slice(1)].join(","));return a}const g=["Pre 1.1.6b","1.1.6b","1.1.7-1.1.9","1.2.0+"];function P(i,a){return g.indexOf(i)>=g.indexOf(a)}async function V(i){let a=[],r=0;e:for(;;){const m=await(await fetch(`https://www.speedrun.com/api/v1/runs?orderby=submitted&direction=desc&game=yd4kq3k6&category=z275n0gk&max=200&embed=players&offset=${r}`)).json(),y=m.data;for(let d=0;d<y.length;d++)if(a.push(y[d]),y[d].id===i)break e;if(!m.pagination.links.some(d=>d.rel==="next"))break;await new Promise(d=>{setTimeout(()=>{d(!0)},60*1e3/100)}),r+=200}return a.map(l=>M(l))}function M(i){const a={id:i.id,category:L.map(r=>N[i.values[r]]),weblink:i.weblink,primary:E(i),primary_t:i.times.primary_t,players:i.players.data.map(r=>r.rel==="guest"?{name:r.name}:{name:r.names.international,weblink:r.weblink}),status:i.status.status};return a.category[3]===void 0&&(a.category[3]="Normal"),a.category.some(r=>r===void 0)&&alert("go tell ambersz to actually pull the variable data from the API instead of hardcoding it..."),a}function E(i){const a=i.times.primary.split(/[a-z.]+/i).filter(l=>l).map((l,m)=>m?l.padStart(2,"0"):l);let r=a[0];for(let l=1;l<a.length;l++)a[l].length===3?r+=".":r+=":",r+=a[l];return r}export{$ as MergedRecords,Y as Opportunities};
