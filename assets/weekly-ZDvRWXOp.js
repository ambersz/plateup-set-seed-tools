var M=Object.defineProperty;var W=(r,e,s)=>e in r?M(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var y=(r,e,s)=>(W(r,typeof e!="symbol"?e+"":e,s),s);import{u,g as j,q as z}from"./jsxRuntime.module-wfZfYPmn.js";import{a as N,b as k,g as C,D as F,R as H,c as L,I as E,d as q,h as b,S as Y,U as $,A as Q,G as V}from"./unlocks-13ZvS0j9.js";class I{constructor(){y(this,"encourageGroups",[k.Special])}GetOptions(e,s,t){const o=t.random;let a=0;for(s!==15&&(a=this.getPad(e,s));a--;)o.value;let g=this.sortCandidates(e,s,t.random);const[h,f]=this.getUnlockGroups(s);let l=null,d=null;for(const p of g)if(!(p.UnlockGroup!==h&&p.UnlockGroup!==f)&&(l===null||l.UnlockGroup!==h&&p.UnlockGroup===h?l=p:(d===null||d.UnlockGroup!==f&&p.UnlockGroup===f)&&(d=p),l&&l.UnlockGroup===h&&d&&d.UnlockGroup===f))break;return[l,d]}getPad(e,s){if(s===15)return 0;let t=C(e).length+1;return s===5&&(t*=2),t}sortCandidates(e,s,t){let o=C(e),a=D(o,t);return t.valueFloat<.5&&a.sort((h,f)=>{let l=0;return G(h)&&l--,G(f)&&l++,l}),a}getUnlockGroups(e){return e===15?[k.Franchise,k.Franchise]:e===5?[k.PrimaryTheme,k.PrimaryTheme]:[k.Dish,k.Generic]}}class J extends I{getPad(e,s){let t=C(e,!1).length+1;return s!==5&&(t*=2),t}sortCandidates(e,s,t){let o=C(e),a=D(o,t);return t.valueFloat<.1&&a.sort((h,f)=>{let l=0;return this.encourageGroups.includes(h.UnlockGroup)&&l--,this.encourageGroups.includes(f.UnlockGroup)&&l++,l}),a}}class K extends I{constructor(){super(...arguments);y(this,"ThanksgivingCards",["Turkey","Nut Roast"])}getPad(s,t){if(t===15)return 0;let o=C(s,!1).length+1;if(t===5){let a=C(s);o+=a.length+2}return o}sortCandidates(s,t,o){let a=t===5||t===15?C(s,!1):C(s),g=D(a,o);return o.valueFloat<.5&&g.sort((l,d)=>{let p=0;return G(l,!1)&&p--,G(d,!1)&&p++,p}),t!==5&&t!==15&&o.valueFloat<.25&&g.sort((d,p)=>{let w=0;return this.ThanksgivingCards.includes(d.Name)&&w++,this.ThanksgivingCards.includes(p.Name)&&w--,w}),g}getUnlockGroups(s){return s===15?[k.Franchise,k.Franchise]:s===5?[k.PrimaryTheme,k.PrimaryTheme]:[k.Dish,k.Dish]}}function D(r,e){return r.map(t=>[t,e.valueFloat]).sort((t,o)=>t[1]-o[1]).map(t=>t[0])}class X{constructor(e){y(this,"cards");y(this,"unlockPack");y(this,"seed");this.cards=[],this.unlockPack=new I,this.seed=e}addCard(e){if(e!==void 0){switch(e.Name){case"Community":this.unlockPack=new K;break;case"Turbo":this.unlockPack=new J;break}this.cards.push(e)}}getUnlockOptions(e){const t=Z(848292,e,this.seed).useSubcontext(1);return this.unlockPack.GetOptions(this.cards,e,t)}getCustomers(e,s=1){return[]}getGroupSizeRange(e){if(this.cards.some(a=>a.Name==="Community")){const a=Math.floor((e-1)/3);return[a+1,a+2]}let t=1,o=2;return this.cards.some(a=>a.Name==="Individual Dining")?[1,1]:(this.cards.some(a=>a.Name==="Medium Groups")&&(t++,o+=2),this.cards.some(a=>a.Name==="Large Groups")&&(t+=2,o+=4),this.cards.some(a=>a.Name==="Flexible Groups")&&(t--,o++),[t,o])}}function Z(r,e,s){return new N(s,r*1231231+e)}function G(r,e=!0){return r.UnlockGroup===k.Special||r.DishType===F.Main||r.DishType===F.Extra?!0:e?!!r.Requires.length:!1}function ee(r=void 0){const e=r?new Date(r):new Date,s=e.getUTCFullYear(),t=r?new Date(r):new Date;t.setUTCMonth(0),t.setUTCDate(1),t.setUTCHours(0,0,0,0);let o=t.getUTCDay()%7;const a=(o?1:0)+Math.floor((e.valueOf()-t.valueOf()+o*24*60*60*1e3)/(7*24*60*60*1e3));return console.log({today:e,year:s,newYear:t,weekOffset:o,weeks:a}),console.log(`${s}, ${a}`),[s,a]}function A(){const r=ne(),e=new N(r,8853129);let s=e.useSubcontext(0).random.range(0,5);const t=H[s],o=e.useSubcontext(1).random.select(L);return{seed:r,setting:t,dish:o,mapSize:se(r)}}function te(){const{seed:r,setting:e,dish:s,mapSize:t}=A();let o=[[e,s]];const a=new X(r);let g=[3,5,6,9,12];for(;g.length;){const h=g.shift();let f=[];for(;o.length;){const l=o.shift();a.cards=l,a.getUnlockOptions(h).forEach(p=>f.push([...l,p]))}o=f}return o}function ne(){const[r,e]=ee();return re(200*r+e)}function re(r){const e=new q(r);let s="";for(let t=0;t<8;t++)s+=E[e.range(0,E.length)];return s}function se(r){switch(new N(r,5078598).useSubcontext(0).random.range(0,8)){case 0:return[2,84];case 4:return[2,70];case 1:case 5:return[1,60];case 2:case 6:return[3,9*13];case 3:case 7:return[4,16*12];default:throw new Error("Layout index out of bounds")}}const v=A(),O=te(),T={[v.setting.Name]:!0,[v.dish.Name]:!0};for(let r=0;r<O[0].length;r++)for(const e of O)T[e[r].Name]===void 0&&(T[e[r].Name]=!1);console.log({weeklyConfig:v,cardPaths:O});const oe=({defaultSeed:r=v.seed,disableSeedInput:e=!0,cardDefaults:s=T,maxRerolls:t})=>{const[o,a]=b(r),[g,h]=b(1),[f,l]=b(R),[d,p]=b(s),w=n=>{p(c=>({...c,[n.target.id]:n.target.checked}))};let S=[];for(const[n,c]of Object.entries(d))c&&S.push(n);const U={seed:o,day:g,upgradeChance:o.indexOf("az")>-1?.25:0,blueprintCount:o.indexOf("az")>-1?7:5,ownedAppliances:f,cards:S},x=n=>{h(Number(n.target.value))},P=n=>{a(n.target.value)},i=n=>{const c=n.target;l(m=>({...m,[c.id]:c.checked}))};return u(j,{children:[u("h3",{children:["Seed:"," ",e?o:u("input",{disabled:e,value:o,onChange:P})]}),u("label",{children:"Shop after completing day "}),u("input",{style:"border:none;width:2.5em",type:"number",value:g,onChange:x}),u("div",{children:Object.entries(d).map(([n,c])=>u("span",{style:"margin:0 20px 0 0",children:[u("label",{for:n,children:n}),u("input",{type:"checkbox",id:n,checked:c,onChange:w})]}))}),u("div",{children:B.map(n=>u("span",{style:"margin:0 25px 0 0",children:[u("label",{for:n,children:["Own ",n,"?"]}),u("input",{type:"checkbox",checked:f[n],id:n,onChange:i})]}))}),u(le,{...U,maxRerolls:t??ce(g)})]})},R={},B=["Blueprint Cabinet","Plates","Research Desk"];for(const r of B)R[r]=!1;R["Blueprint Cabinet"]=!0;const ae=[!0,!1],ie=[!0,!1],le=({seed:r,day:e=1,blueprintCount:s,upgradeChance:t,ownedAppliances:o,cards:a,maxRerolls:g})=>{const h=new Y(r,t);for(let i=0;i<=a.length;i++)if(a[i]){const n=$.filter(c=>c.Name===a[i])[0];n&&h.addCard(n)}const f=Object.entries(o).filter(i=>i[1]).map(i=>i[0]).map(i=>Q.filter(n=>n.Name===i)[0]);for(const i of f)i&&h.OwnedAppliances.push(i);let l=[];for(const i of ie)for(const n of ae)if(l.push({spawnInside:i,playerInside:i?void 0:n,blueprintCount:s}),i)break;const d=[];let p=[[],[],[],[]];for(let i=0;i<l.length;i++)for(let n=0;n<l.length;n++){d.push([l[i],l[n]]);const c=[l[i].spawnInside,l[i].playerInside,l[n].spawnInside,l[n].playerInside];for(let m=0;m<c.length;m++)p[m].length&&p[m].at(-1).val===c[m]?p[m].at(-1).run+=1:p[m].push({val:c[m],run:1})}let w=[];const S=s,U=4,x=g;for(let i=0;i<x;i++){const n=[];for(const c of i?d:d.map(m=>[m[0]])){const m=[...c];i&&m.splice(-1,1,{...m.at(-1),blueprintCount:S+U}),n.push(h.getAppliances(m,e).map(_=>_.Name))}if(w.push(n),i)for(let c=0;c<d.length;c++)d[c].push(d[c][d[c].length-1])}const P=(i,n)=>{switch(i){case 0:return n?"Spawn Inside":"Spawn Outside";case 1:return n===void 0?"":n?"Stand Inside at End of Day":"Everyone Outside at End of Day";case 2:return n?"Spawn Inside for Rerolls":"Spawn Outside for Rerolls";case 3:return n===void 0?"":n?"Someone Inside when Rerolling":"Everyone Outside when Rerolling";default:throw new Error("Too Many Headers")}};return u("table",{children:[u("thead",{children:p.map((i,n)=>u("tr",{children:[!n&&u("th",{colSpan:1,rowSpan:4,children:"Reroll #"}),i.map(c=>c.val!==void 0&&u("th",{colSpan:c.run,rowSpan:P(n,c.val).indexOf("Spawn Inside")>-1?2:1,scope:"colgroup",children:P(n,c.val)}))]}))}),w.map((i,n)=>u("tr",{children:[u("th",{children:n||"Spawn"}),n?i.map(c=>u("td",{colspan:1,children:u(V,{ghostCount:U,bps:c})})):u("td",{style:"text-align:center;",colSpan:16,children:i[0].join(", ")})]}))]})};function ce(r){return[5,8,10,12,13,15,16,18,19,20,21,22,23,24,25][r-1]+1}const ue=["Breakfast","Breakfast Eggs","Breakfast Extras","Breakfast Beans","Pumpkin Seed"];for(const r of ue);z(u(oe,{disableSeedInput:!0,maxRerolls:5}),document.getElementById("app"));
