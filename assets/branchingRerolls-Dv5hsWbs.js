import{r as M,s as W,p as _,U as J,R as $,S as A,u as r,m as K,g as B,k as Q,b as V,i as F}from"./main-DuVFAb8A.js";import{G as X}from"./GhostBlueprints-CH8J7_Z3.js";import{u as Z}from"./usePersistentState-BV3e9HVq.js";function ee(l){let o="";if(!l.length)o="Spawn: any settings";else{for(let e=0;e<l.length;e++){const d=l[e];let n=e?`Reroll ${e}`:"Spawn";n+=": ",n+="Blueprints "+(d.spawnInside?"Spawn Inside":"Spawn Outside, "+(d.playerInside?"Someone Inside":"All Players Stand Outside")),e&&(n+=`, reroll ${l[e].blueprintCount} blueprints`),o+=n+`
`}o+=`Reroll ${l.length}: any settings`}const u=o.split(`
`);return r("div",{class:"tooltip-container",children:r("div",{class:"reroll-instructions",onClick:e=>{if(e.detail<2)return;const d=document.createRange();d.selectNodeContents(e.currentTarget);const n=document.getSelection();n==null||n.removeAllRanges(),n==null||n.addRange(d)},children:u.map(e=>r("div",{children:e}))})})}function ne(l,o,u){const e=l.at(-1);if(o==="insideOnly"||u&&o==="noSwitching"||o==="noSwitching"&&(e!=null&&e.spawnInside))switch(((e==null?void 0:e.blueprintCount)??0)%3){case 0:return"I";case 1:return"OI";default:return"OO"}return e!=null&&e.spawnInside?"I":e!=null&&e.playerInside?"OI":"OO"}const te=[0,3,5,6,9,12,15,18,21,24,27,30],re=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],se=({seed:l,day:o,startingConfig:u=[],searchDepth:e=2,ghostBlueprints:d=2,blueprintCabinets:n=1,solo:m,cards:c=[],appliances:L=[],simpleBPSettings:w=!1})=>{var G,x,U;const k=c.some(t=>t.Name==="Turbo"),f=k?7:5,y=Q(0);l=l.toLocaleLowerCase().trim();const Y={blueprintCount:f+d,spawnInside:!0},p=new V(l,0);y.value&&(p.numTiles=y.value);let P=[];const j=k?re:te,C=[];let N=!1,R=!1,O=!1,D=!1,b=!1;{let t=c.filter(s=>$.some(a=>a.ID===s.ID)).length;for(let s=0;s<t;s++)p.addCard(c[s]);for(const s of j){if(s>o)break;const a=c[t];a===void 0?(C.push(s),b=!0):s===0?A.some(i=>i.ID===a.ID)||(N=a,b=!0):s===5?a.UnlockGroup!==F.PrimaryTheme&&(R=a,b=!0):(a.UnlockGroup===F.PrimaryTheme&&(O=a),A.some(i=>i.ID===a.ID)&&p.Cards.every(i=>i.Name!=="Community")&&(D=a)),s===o?(P.push(a),p.handleNewCardSpawnEffects(a)):p.addCard(a),t++}}p.OwnedAppliances=[...p.OwnedAppliances,...L];const g=[],I=[];for(let t=-n-1;t<=n;t++){const s={spawnInside:!0,blueprintCount:f+t};t===0&&I.push(s),g.push(s),w!=="insideOnly"&&(t===0&&(I.push({spawnInside:!1,playerInside:!0,blueprintCount:f+t}),I.push({spawnInside:!1,playerInside:!1,blueprintCount:f+t})),m||g.push({spawnInside:!1,playerInside:!0,blueprintCount:f+t}),g.push({spawnInside:!1,playerInside:!1,blueprintCount:f+t}))}let T=[],h=[u];for(let t=0;t<=e;t++){if(t)for(const i of P)p.handleNewCardRerollEffects(i);let s=[],a=[];for(let i=0;i<h.length;i++){const E={...Y};E.blueprintCount=h[i].length?(((G=h[i].at(-1))==null?void 0:G.blueprintCount)??f)+d:f;const z=p.getAppliances([...h[i],E],o).map(v=>v.Name),H=w==="noSwitching"?m||(U=(x=h[i])==null?void 0:x[0])!=null&&U.spawnInside?g.length/(m?2:3):g.length*2/3:g.length;a.push(r("td",{class:"reroll-cell "+ne(h[i],w,m),colspan:H**(e-t),children:[ee(h[i]),r(X,{bps:z,ghostCount:t===0?0:d})]}));const q=u.length+t===0?I:g;for(const v of q){const S=[...h[i]];w==="noSwitching"&&S.length&&S[0].spawnInside!==v.spawnInside||(S.push(v),s.push(S))}}T.push(r("tr",{children:[r("td",{children:t?`Reroll ${t}`:"Spawns"}),a]})),h=s}return r(B,{children:[r("label",{children:"Number of indoor tiles (0 to default to normal layout):"}),r("input",{value:y,type:"number",onChange:t=>{y.value=t.target.valueAsNumber}}),b&&r("div",{class:"error-background",children:["Card Path Configuration Errors:",N&&r("div",{children:["Starting card (",N.Name,") is not a valid starting dish. Please enter your starting dish (and map setting if running Turbo) as the first card(s)"]}),!!C.length&&r("div",{children:["Missing card",C.length>1&&"s"," for day",C.length>1&&"s"," ",C.join(", "),". Please enter your full card path"]}),R&&r("div",{children:["Card added for day 5 (",R.Name,") is not a theme card. You may have entered your card path in the wrong order, or forgotten to add the Turbo map setting card"]}),D&&r("div",{children:["Added starting dish ",D.Name," in the middle of a non-Autumn run. You may have entered your card path in the wrong order or forgotten to include the Community card"]}),O&&r("div",{children:["Added ",O.Name,", but not on day 5. You may have entered your card path in the wrong order, or have the wrong map setting card entered."]})]}),r("table",{children:[" ",T," "]})]})},ae={seed:"az",day:1,cards:[],initialRerollConfig:[],solo:!1,appliances:M,searchDepth:2,simpleBPSettings:"full"},de=()=>{const[l,o]=Z(ae,"BRANCH_CONFIG",d=>{let n={...d};if(typeof n.simpleBPSettings=="boolean"){debugger;n={...n,simpleBPSettings:d.simpleBPSettings?"insideOnly":"full"}}return n={...n,searchDepth:2},n}),[u,e]=W();return _(()=>{if(u.has("cards")){const d=u.get("cards").split(",").map(n=>J.filter(c=>c.Name===n)[0]??$.filter(c=>c.Name===n)[0]??A.filter(c=>c.Name===n)[0]);o(n=>({...n,seed:u.get("seed")??n.seed,cards:d,solo:!!Number(u.get("solo"))})),e(new URLSearchParams,{replace:!0})}},[u]),r(B,{children:[r("div",{children:["Hover over a cell for instructions on how to get those blueprints. Getting the blueprints in grey requires taking extra blueprints out of cabinets."," ",r("span",{style:"font-size:small",children:"(Rerolls are inaccurate if you bought a blueprint desk)"})]}),r(K,{onConfigChange:o,config:l,mode:"rerolls"}),r(se,{...l,blueprintCabinets:1}),!1]})};export{de as default,ae as defaultBranchingRerollConfig};
