import{A as $,h as E,j as V,T as z,u as e,k as G,p as M,U as q,g as H,c as W}from"./main-ILnlsvFW.js";import{G as J}from"./GhostBlueprints-kC0cLQb2.js";import{u as O,a as I,U as Q}from"./UnlockSelect-_O7UJL5_.js";import{u as X}from"./usePersistentState-cuKdv425.js";const B=[...$].filter(t=>t.IsPurchasable||t.IsPurchasableAsUpgrade);console.log({options:B.length,unique:new Set(B.map(t=>t.ID)).size});function Y(t,a,i,s){const l=a.toLowerCase();return B.filter(function(c){return i&&c.AllowRefreshes&&!c.SellOnlyAsDuplicate&&t.some(g=>g.AllowRefreshes)?!1:(s||!t.some(g=>g.ID===c.ID))&&c.Name.toLowerCase().includes(l)&&(!i||c.StapleWhenMissing||c.SellOnlyAsUnique||!c.SellOnlyAsDuplicate&&c.AllowRefreshes)}).sort((r,c)=>r.Name<c.Name?-1:1)}function Z({onSelectionChange:t,label:a,placeholder:i,include:s=!0,appliances:l=[],shopModifiersOnly:r=!0,allowDupes:c=!1}){const[g,w]=E(""),f=V(()=>Y(l,g,r,c),[l,g]),{getSelectedItemProps:N,getDropdownProps:h,removeSelectedItem:d}=O({selectedItems:l,onStateChange({selectedItems:p,type:u}){switch(u){case O.stateChangeTypes.SelectedItemKeyDownBackspace:case O.stateChangeTypes.SelectedItemKeyDownDelete:case O.stateChangeTypes.DropdownKeyDownBackspace:case O.stateChangeTypes.FunctionRemoveSelectedItem:t(p??[]);break}}}),{isOpen:o,getToggleButtonProps:R,getLabelProps:S,getMenuProps:T,getInputProps:y,highlightedIndex:v,getItemProps:k,selectedItem:C}=I({items:f,itemToString(p){return p?p.Name:""},defaultHighlightedIndex:-1,selectedItem:null,inputValue:g,stateReducer(p,u){const{changes:n,type:m}=u;switch(m){case I.stateChangeTypes.InputChange:return u.inputValue?{...n,highlightedIndex:0}:{...n,highlightedIndex:-1};case I.stateChangeTypes.InputKeyDownEnter:return{...n,isOpen:!1,highlightedIndex:-1};case I.stateChangeTypes.ItemClick:return{...n,isOpen:!0,highlightedIndex:-1};default:return n}},onStateChange({inputValue:p,type:u,selectedItem:n}){switch(u){case I.stateChangeTypes.InputKeyDownEnter:case I.stateChangeTypes.ItemClick:case I.stateChangeTypes.InputBlur:n&&(t([...l,n]),w(""));break;case I.stateChangeTypes.InputChange:w(p??"");break}}}),D=z(()=>{t([])},[]);return e("div",{className:"combo-container",children:[e("div",{className:"",children:[e("label",{className:"",...S(),children:a??"Select desired appliances"}),e("div",{children:e("button",{onClick:D,children:"Clear Appliances"})}),e("div",{className:"",children:[l.map(function(u,n){return e("span",{className:"selected-items"+(s?" include":" exclude"),...N({selectedItem:u,index:n}),children:[u.Name,e("span",{class:"x",onClick:m=>{m.stopPropagation(),d(u)},children:"âœ•"})]},`selected-item-${n}`)}),e("div",{className:"",children:e("input",{placeholder:i??"Appliance Selection(s)",className:"",...y(h({preventKeyAction:o}))})})]})]}),e("ul",{className:`dropdown ${o&&f.length?"":"hidden"}`,...T(),children:[!1,o&&f.map((p,u)=>e("li",{className:ee(v===u&&"bg-blue-300",C===p&&"font-bold","py-2 px-3 shadow-sm flex flex-col"),...k({item:p,index:u}),children:e("span",{children:p.Name})},`${p.ID}${u}`))]})]})}const ee=(...t)=>t.filter(a=>a).join(" ");function ne(t){let a="";if(!t.length)a="Spawn: any settings";else{for(let s=0;s<t.length;s++){const l=t[s];let r=s?`Reroll ${s}`:"Spawn";r+=": ",r+="Blueprints "+(l.spawnInside?"Spawn Inside":"Spawn Outside, "+(l.playerInside?"Someone Inside":"All Players Stand Outside")),s&&(r+=`, reroll ${t[s].blueprintCount} blueprints`),a+=r+`
`}a+=`Reroll ${t.length}: any settings`}const i=a.split(`
`);return e("div",{class:"reroll-instructions",onClick:s=>{if(s.detail<2)return;const l=document.createRange();l.selectNodeContents(s.currentTarget);const r=document.getSelection();r==null||r.removeAllRanges(),r==null||r.addRange(l)},children:i.map(s=>e("div",{children:s}))})}const _=$.filter(t=>t.Name==="Booking Desk"||t.Name==="Blueprint Cabinet").sort((t,a)=>t.Name<a.Name?1:-1);function te(t,a,i){const s=t.at(-1);if(a==="insideOnly"||i&&a==="noSwitching"||a==="noSwitching"&&(s!=null&&s.spawnInside))switch(((s==null?void 0:s.blueprintCount)??0)%3){case 0:return"I";case 1:return"OI";default:return"OO"}return s!=null&&s.spawnInside?"I":s!=null&&s.playerInside?"OI":"OO"}const se=[0,3,5,6,9,12],le=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],ae=({seed:t,day:a,startingConfig:i=[],baseUpgradeChance:s=0,blueprintCount:l=5,searchDepth:r=2,ghostBlueprints:c=2,blueprintCabinets:g=1,solo:w,cards:f=[],appliances:N=[],simpleBPSettings:h=!1})=>{var D,p,u;t=t.toLocaleLowerCase().trim();const d={blueprintCount:l+c,spawnInside:!0},o=new W(t,s),R=l===7;let S=[];const T=R?le:se;{let n=0;for(const m of T){if(m>a){console.log(`added up to card ${n}: ${f.slice(0,n).map(A=>A.Name).join(", ")}`);break}m===a?(S.push(f[n]),o.handleNewCardSpawnEffects(f[n])):o.addCard(f[n]),n++}}o.OwnedAppliances=[...o.OwnedAppliances,...N];const y=[],v=[];for(let n=-g-1;n<=g;n++){const m={spawnInside:!0,blueprintCount:l+n};n===0&&v.push(m),y.push(m),h!=="insideOnly"&&(n===0&&(v.push({spawnInside:!1,playerInside:!0,blueprintCount:l+n}),v.push({spawnInside:!1,playerInside:!1,blueprintCount:l+n})),w||y.push({spawnInside:!1,playerInside:!0,blueprintCount:l+n}),y.push({spawnInside:!1,playerInside:!1,blueprintCount:l+n}))}let k=[],C=[i];for(let n=0;n<=r;n++){if(n)for(const b of S)o.handleNewCardRerollEffects(b);let m=[],A=[];for(let b=0;b<C.length;b++){const U={...d};U.blueprintCount=C[b].length?(((D=C[b].at(-1))==null?void 0:D.blueprintCount)??l)+c:l;const K=o.getAppliances([...C[b],U],a).map(x=>x.Name),L=h==="noSwitching"?w||(u=(p=C[b])==null?void 0:p[0])!=null&&u.spawnInside?y.length/(w?2:3):y.length*2/3:y.length;A.push(e("td",{class:"reroll-cell "+te(C[b],h,w),colspan:L**(r-n),children:[e(J,{bps:K,ghostCount:n===0?0:c}),ne(C[b])]}));const j=i.length+n===0?v:y;for(const x of j){const P=[...C[b]];h==="noSwitching"&&P.length&&P[0].spawnInside!==x.spawnInside||(P.push(x),m.push(P))}}k.push(e("tr",{children:[e("td",{children:n?`Reroll ${n}`:"Spawns"}),A]})),C=m}return e("table",{children:[" ",k," "]})},re=({onConfigChange:t,config:a})=>{const{seed:i,day:s,blueprintCount:l,solo:r,appliances:c=_,cards:g,searchDepth:w,simpleBPSettings:f=!1}=a,N=d=>{let o={...a};d.target.checked?(o.blueprintCount=7,o.baseUpgradeChance=.25):(o.blueprintCount=5,o.baseUpgradeChance=0),t(o)},h=(d,o)=>{t(R=>{let S={...R};return S[d]=o,S})};return e("div",{children:[e("div",{children:[e("div",{children:"Run Config:"}),e("label",{for:"solo",children:"Solo:"}),e("input",{type:"checkbox",id:"solo",checked:r,onChange:()=>{h("solo",!r)}}),e("span",{style:"margin:0 20px",children:[e("label",{for:"simpleRerollSettings",children:"Spawn setting configs: "}),e("select",{value:f===!0?"insideOnly":f===!1?"full":f,onChange:d=>{var o;h("simpleBPSettings",((o=d.target)==null?void 0:o.value)??"full")},children:[e("option",{value:"full",children:"All spawn settings"}),e("option",{value:"insideOnly",children:"Spawn Inside only"}),e("option",{value:"noSwitching",children:"Don't switch bp settings after spawn"})]})]}),e("div",{children:[e("label",{for:"searchDepth",children:"Number of Rerolls"})," ",e("input",{id:"searchDepth",type:"number",value:w,onChange:d=>{h("searchDepth",Number(d.target.value))}})]}),e("label",{for:"seed",value:i,children:["Seed:"," "]}),e("input",{type:"text",id:"seed",value:i,onChange:d=>{h("seed",d.target.value)}}),e("label",{for:"setting",children:" Turbo?"}),e("input",{id:"setting",type:"checkbox",checked:l===7,onChange:N})]}),e("div",{children:[e("label",{for:"day",value:s,children:["Prep of Day:"," "]}),e("input",{type:"number",id:"day",value:s+1,onChange:d=>{h("day",Number(d.target.value)-1)}}),e(Q,{id:"cardSchedule",label:"Enter all cards in order, including your starting dish:",onSelectionChange:d=>{h("cards",d.cards)},showSelectionMode:!1,cards:g,include:!0,modes:["themes","dishes","customerCards"]}),e(Z,{label:"Select owned appliances:",placeholder:"",onSelectionChange:d=>{h("appliances",d)},appliances:c})]})]})},F={seed:"az",day:2,cards:[],initialRerollConfig:[],blueprintCount:5,baseUpgradeChance:0,solo:!1,appliances:_,searchDepth:2,simpleBPSettings:!1},ie=()=>{const[t,a]=X(F,"BRANCH_CONFIG",l=>{if(typeof l.simpleBPSettings=="boolean"){debugger;return{...l,simpleBPSettings:l.simpleBPSettings?"insideOnly":"full"}}return l}),[i,s]=G();return M(()=>{i.has("cards")&&(a(l=>({...l,seed:i.get("seed")??l.seed,cards:i.get("cards").split(",").map(r=>q.filter(c=>c.Name===r)[0]),blueprintCount:i.get("turbo")?7:5,baseUpgradeChance:i.get("turbo")?.25:0,solo:!!Number(i.get("solo"))})),s(new URLSearchParams,{replace:!0}))},[i]),e(H,{children:[e("div",{children:["Hover over a cell for instructions on how to get those blueprints. Getting the blueprints in grey requires taking extra blueprints out of cabinets."," ",e("span",{style:"font-size:small",children:"(Rerolls are inaccurate if you bought a blueprint desk)"})]}),e(re,{onConfigChange:a,config:t}),e(ae,{...t,blueprintCabinets:1}),!1]})},pe=Object.freeze(Object.defineProperty({__proto__:null,default:ie,defaultBranchingRerollConfig:F},Symbol.toStringTag,{value:"Module"}));export{Z as A,pe as b,F as d};
