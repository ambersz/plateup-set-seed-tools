var C=Object.defineProperty;var D=(h,e,t)=>e in h?C(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var c=(h,e,t)=>(D(h,typeof e!="symbol"?e+"":e,t),t);import{D as d,d as k,F as f,c as M}from"./prng-JpF06ZO8.js";const y={"Diner (1)":1,"Small (2)":2,"Medium (2)":2,"Large (3)":3,"Huge (4)":4};class R{constructor(e,t=[],s=[]){c(this,"seed");c(this,"mapSize");c(this,"frontDoor");c(this,"startingCards");c(this,"cards");c(this,"playerCount");c(this,"turbo");c(this,"_cardsByDay",[]);this.seed=e,this.mapSize=this.getMapSize(),this.frontDoor=this.getDoorInfo(),this.startingCards=t,this.cards=s,this.playerCount=y[this.mapSize],this.turbo=this.startingCards.some(r=>{if(r===void 0){console.log({startingCards:t});debugger}return r.Name==="Turbo"})}guessMoney(e){if(e===0)return this.turbo?30:0;const t=this.getCardsByDay(e),s=1+t.filter(i=>i.Name==="All You Can Eat"||i.Name==="Double Helpings").length*.25,r=this.getCustomerCount(e)*s;let o=this.startingCards.reduce((i,l)=>i+l.DishValue,0);if(t.some(i=>i.Name==="Ice Cream")&&(this.startingCards.some(i=>i.DishType=d.Dessert)||(o=(o+2)/2)),t.some(i=>i.Name==="Doughnut")&&(o=5),t.some(i=>i.Name==="Double Helpings")&&o&&(o+=3),Number.isNaN(r))debugger;if(Number.isNaN(o))debugger;const a=S(this.playerCount),n=this.getBookingDeskCount(e),u=this.getBookingDeskMoney(e);return a*(r*o+n*u)}getBookingDeskMoney(e){return Math.ceil((e+1)/2)+2}getCardsByDay(e){if(this._cardsByDay[e]===void 0){let t;this.turbo?t=e-1:(t=Math.max(0,Math.floor((e-1)/3)),e>5&&t++),this._cardsByDay[e]=[...this.startingCards,...this.cards.slice(0,t)]}return this._cardsByDay[e]}getBookingDeskCount(e,t=1){const s=Math.ceil(this.getExpectedCustomers(e)/this.getExpectedGroupSize(e));if(this.getCardsByDay(e).some(i=>i.Name==="Herd Mentality"))return Math.min(s,3)+1;const r=[],o=this.getCardsByDay(e);let a=1;(this.turbo||o.some(i=>i.Name==="Morning Rush"))&&(r.push(.2),a++),(this.turbo||o.some(i=>i.Name==="Lunch Rush"))&&(r.push(.5),a++),(this.turbo||o.some(i=>i.Name==="Dinner Rush"))&&(r.push(.8),a++);const n=t/this.getDayLength(e),u=.1/s;for(let i=1;i<s;i++){const l=i/s,m=l-u-n,g=l+u+n;let p=!1;for(const b of r)if(m<=b&&g>=b){p=!0;break}p||a++}return a}getNonRushGroupCount(e){const t=this.getExpectedCustomers(e),s=this.getCardsByDay(e).filter(a=>a.Name==="Closing Time?").length*.2,r=this.getExpectedGroupSize(e),o=t*(1+s)/r;return Math.ceil(o)}getCustomerCount(e){return this.getGroupSizes(e).reduce((t,s)=>t+s,0)}getGroupSizes(e){const t=k(1997821,e,this.seed).random,s=this.getNonRushGroupCount(e),r=this.getCardsByDay(e).some(g=>g.Name==="Herd Mentality");let o=s,a=[],[n,u]=this.getGroupSizeRange(e);{let g=o-1;for(;g--;)t.value}for(;o--;)a.push(t.range(n,u+1)),!r&&o!==s-1&&t.value;let i=this.turbo?3:this.getCardsByDay(e).filter(g=>g.Name.includes(" Rush")).length;const l=Math.ceil(Math.max(1,this.getExpectedCustomers(e)*.15));let m=i*l;for(;m--;)a.push(t.range(n,u+1));return a}getExpectedGroupSize(e){const t=this.getGroupSizeRange(e);return(t[0]+t[1])/2}getGroupSizeRange(e){let t=1,s=2;for(const r of this.getCardsByDay(e))switch(r.Name){case"Individual Dining":s--;break;case"Medium Groups":t++,s+=2;break;case"Large Groups":t+=2,s+=2;break;case"Flexible Dining":t--,s++;break;case"Community":const o=Math.floor((e-1)/3);t+=o,s+=o;break}return[t,s]}getExpectedCustomers(e){const t=this.getReductions(e),s=this.getDayLength(e),r=this.getPlayerModifier(),o=this.getCourseModifier(e),a=this.getDayRate(e),n=this.getCustomersPerHour(e),u=this.getAdvertisingModifier(e);return .85**t*(s/25*a*r)/o*n*u}getAdvertisingModifier(e){return 1+.25*this.getCardsByDay(e).filter(s=>s.Name==="Advertising").length}getDayRate(e){let t=1;switch(e){case 1:t=1.25;break;case 2:t=1.5;break;default:t=1.5+.15*(e-3);break}return e>15&&(t+=(this.turbo?.1:0)*(e-15)**1.5),t}getCourseModifier(e){let t=1;const s=this.getCardsByDay(e);return s.some(r=>r.DishType===d.Dessert||r.Name==="Black Coffee"||r.Name==="Cakes")&&(t+=.25),s.some(r=>r.DishType===d.Starter)&&(t+=.25),t}getPlayerModifier(){let e;switch(this.playerCount){case 0:e=1;break;case 1:e=.8;break;case 2:e=1;break;case 3:e=1.25;break;default:e=1.5;break}return e}getDayLength(e){return 100+Math.floor(e/3)*25}getCustomersPerHour(e){let t=1;return this.turbo&&(t=1.5,t*=1+e/10),t}getReductions(e){return this.getCardsByDay(e).reduce((s,r)=>s+r.CustomerMultiplier,0)}getMapSize(){const t=new f(this.seed,5078598).useSubcontext(0).random.range(0,8);let s;switch(t){case 0:s="Small (2)";break;case 4:s="Medium (2)";break;case 1:case 5:s="Diner (1)";break;case 2:case 6:s="Large (3)";break;case 3:case 7:s="Huge (4)";break;default:throw new Error}return s}getLayoutInfo(){const t=new f(this.seed,5078598).useSubcontext(0).random.range(0,8);let s,r;switch(t){case 0:r=70,s=2;break;case 4:r=84,s=2;break;case 1:case 5:r=60,s=1;break;case 2:case 6:r=9*13,s=3;break;case 3:case 7:r=12*16,s=4;break;default:throw new Error}return[s,r]}getDoorInfo(){if(this.mapSize!=="Diner (1)")return-1;let e=new M(new f(this.seed,98234234).useSubcontext(0).random.value),t=23;for(;t--;)e.value;return e.range(0,4)}}function S(h){switch(h){case 1:return 1.25;case 2:return 1.1;default:return 1}}const x=["Diner (1)","Small (2)","Medium (2)","Large (3)","Huge (4)"];export{R,x as t};
